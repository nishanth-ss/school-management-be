const a70_0x5481b7=a70_0x3bf6;(function(_0x44ef8f,_0x11081b){const _0x4c529e=a70_0x3bf6,_0x449f33=_0x44ef8f();while(!![]){try{const _0x168607=parseInt(_0x4c529e(0xfa))/0x1*(-parseInt(_0x4c529e(0xce))/0x2)+parseInt(_0x4c529e(0xcb))/0x3*(-parseInt(_0x4c529e(0xe9))/0x4)+-parseInt(_0x4c529e(0xde))/0x5*(-parseInt(_0x4c529e(0xf7))/0x6)+parseInt(_0x4c529e(0xf6))/0x7+-parseInt(_0x4c529e(0xc5))/0x8+parseInt(_0x4c529e(0xfd))/0x9+parseInt(_0x4c529e(0xe1))/0xa*(parseInt(_0x4c529e(0xc6))/0xb);if(_0x168607===_0x11081b)break;else _0x449f33['push'](_0x449f33['shift']());}catch(_0x3260e5){_0x449f33['push'](_0x449f33['shift']());}}}(a70_0x3e3a,0x95446));const financialModel=require(a70_0x5481b7(0xd5)),InmateLocation=require('../model/studentLocationModel'),inmateModel=require(a70_0x5481b7(0xf3)),posShoppingCart=require(a70_0x5481b7(0xfe)),tuckShopModel=require(a70_0x5481b7(0xc7));function a70_0x3bf6(_0x407629,_0x5cd3b1){_0x407629=_0x407629-0xc5;const _0x3e3a96=a70_0x3e3a();let _0x3bf67c=_0x3e3a96[_0x407629];return _0x3bf67c;}function a70_0x3e3a(){const _0x28afda=['toLowerCase','name\x20price\x20category\x20type','location_id','depositAmount','../model/financialModel','depositLimit','Inmate\x20not\x20found','Deposit\x20limit\x20exceeded\x20for\x20','replace','products.productId','Recharge\x20purchase\x20allowed','.\x20Limit:\x20₹','Internal\x20server\x20error','1005eIzOZe','is_blocked','category','10OVYVpz','wages',',\x20Attempted\x20total:\x20₹','checkTransactionLimit','\x20is\x20currently\x20blocked','_id','custodyLimits','recharge','11812nqNutF','length','error','Transaction\x20allowed','price','name','spendAmount','deposit','type','toString','../model/studentModel','quantity','No\x20limits\x20configured\x20for\x20custody\x20type\x20\x22','2756901uHMOZB','9798hDSjfe','productId','setDate','10IRctXl','inmateId','find','6950844XYkzCQ','../model/posShoppingCart','custodyType','checkProductsLimit','4961960BnOzpB','10718477iVmPhc','../model/tuckShopModel','spend','setHours','reduce','186mDkGrU','spendLimit','Inmate\x20','210814RJHYSI','findOne','populate'];a70_0x3e3a=function(){return _0x28afda;};return a70_0x3e3a();}exports[a70_0x5481b7(0xe4)]=async(_0x35a445,_0x413787,_0x460178)=>{const _0x1455ad=a70_0x5481b7;try{const _0x4784b4=new Date();_0x4784b4['setDate'](0x1),_0x4784b4[_0x1455ad(0xc9)](0x0,0x0,0x0,0x0);const _0x4faa99=_0x460178===_0x1455ad(0xf0)||_0x460178==='wages'?{'$in':[_0x1455ad(0xf0),_0x1455ad(0xe2)]}:_0x460178,_0x43aba1=await financialModel['find']({'inmateId':_0x35a445,'type':_0x4faa99,'createdAt':{'$gte':_0x4784b4}});let _0x4a4aea=0x0;if(_0x460178===_0x1455ad(0xe2)||_0x460178===_0x1455ad(0xf0))_0x4a4aea=_0x43aba1[_0x1455ad(0xca)]((_0x44d081,_0x1cd8b1)=>{const _0x545410=_0x1455ad;return _0x44d081+(_0x1cd8b1['wageAmount']||0x0)+(_0x1cd8b1[_0x545410(0xd4)]||0x0);},0x0);else _0x460178==='spend'&&(_0x4a4aea=_0x43aba1[_0x1455ad(0xca)]((_0x490c54,_0x1c1bb5)=>_0x490c54+(_0x1c1bb5[_0x1455ad(0xef)]||0x0),0x0));const _0x2d1c1c=await inmateModel[_0x1455ad(0xcf)]({'inmateId':_0x35a445})['populate'](_0x1455ad(0xd3));if(!_0x2d1c1c||!_0x2d1c1c[_0x1455ad(0xd3)])return{'status':![],'message':'Inmate\x20or\x20location\x20data\x20not\x20found'};if(_0x2d1c1c[_0x1455ad(0xdf)]==='true')return{'status':![],'message':_0x1455ad(0xcd)+_0x2d1c1c[_0x1455ad(0xfb)]+'\x20is\x20currently\x20blocked'};const _0x362617=_0x2d1c1c[_0x1455ad(0xd3)],_0x227b5b=_0x2d1c1c[_0x1455ad(0xff)][_0x1455ad(0xd1)]()[_0x1455ad(0xd9)](/\s+/g,'_'),_0x7bf057=_0x362617[_0x1455ad(0xe7)]?.[_0x1455ad(0xfc)](_0x9fd6a0=>{const _0x56adf5=_0x1455ad;return _0x9fd6a0[_0x56adf5(0xff)]['toLowerCase']()===_0x227b5b;});if(!_0x7bf057)return{'status':![],'message':_0x1455ad(0xf5)+_0x227b5b+'\x22'};const _0x57ceaf=_0x4a4aea+_0x413787;if((_0x460178===_0x1455ad(0xf0)||_0x460178==='wages')&&_0x7bf057[_0x1455ad(0xd6)]!=null){if(_0x57ceaf>_0x7bf057['depositLimit'])return{'status':![],'message':_0x1455ad(0xd8)+_0x227b5b+'.\x20Limit:\x20₹'+_0x7bf057[_0x1455ad(0xd6)]+',\x20Attempted\x20total:\x20₹'+_0x57ceaf};}if(_0x460178===_0x1455ad(0xc8)&&_0x7bf057[_0x1455ad(0xcc)]!=null){if(_0x57ceaf>_0x7bf057['spendLimit'])return{'status':![],'message':'Spend\x20limit\x20exceeded\x20for\x20'+_0x7bf057[_0x1455ad(0xff)]+_0x1455ad(0xdc)+_0x7bf057[_0x1455ad(0xcc)]+_0x1455ad(0xe3)+_0x57ceaf};}return{'status':!![],'message':_0x1455ad(0xec)};}catch(_0x503f99){return{'status':![],'message':_0x1455ad(0xdd)};}},exports[a70_0x5481b7(0x100)]=async(_0x2e97a6,_0x343160=[])=>{const _0x2117ba=a70_0x5481b7;try{const _0x66cd0c=new Date();_0x66cd0c[_0x2117ba(0xf9)](0x1),_0x66cd0c[_0x2117ba(0xc9)](0x0,0x0,0x0,0x0);const _0x50cc26=await posShoppingCart[_0x2117ba(0xfc)]({'inmateId':_0x2e97a6,'is_reversed':![],'createdAt':{'$gte':_0x66cd0c}})[_0x2117ba(0xd0)]({'path':_0x2117ba(0xda),'model':'TuckShop','select':_0x2117ba(0xd2)});let _0x48f8db=0x0;for(const _0x38713c of _0x50cc26){for(const _0x54dac8 of _0x38713c['products']){const _0x499c31=_0x54dac8[_0x2117ba(0xf8)];if(!_0x499c31)continue;const _0x5be2b5=_0x499c31[_0x2117ba(0xe0)]&&_0x499c31[_0x2117ba(0xe0)][_0x2117ba(0xd1)]()==='recharge'||_0x499c31[_0x2117ba(0xf1)]&&_0x499c31[_0x2117ba(0xf1)]['toLowerCase']()==='recharge'||_0x499c31['name']&&_0x499c31['name'][_0x2117ba(0xd1)]()['includes'](_0x2117ba(0xe8));_0x5be2b5&&(_0x48f8db+=(_0x499c31['price']||0x0)*(_0x54dac8[_0x2117ba(0xf4)]||0x1));}}if(_0x343160[_0x2117ba(0xea)]){const _0xa8b7c2=_0x343160['map'](_0xd3ec95=>_0xd3ec95[_0x2117ba(0xf8)]),_0xee7cb5=await tuckShopModel[_0x2117ba(0xfc)]({'_id':{'$in':_0xa8b7c2}});for(const _0x8cff4e of _0x343160){const _0x5052dc=_0xee7cb5[_0x2117ba(0xfc)](_0x386fee=>_0x386fee[_0x2117ba(0xe6)][_0x2117ba(0xf2)]()===_0x8cff4e[_0x2117ba(0xf8)]);if(!_0x5052dc)continue;const _0x452ce9=_0x5052dc['category']&&_0x5052dc[_0x2117ba(0xe0)][_0x2117ba(0xd1)]()==='recharge'||_0x5052dc[_0x2117ba(0xf1)]&&_0x5052dc[_0x2117ba(0xf1)][_0x2117ba(0xd1)]()==='recharge'||_0x5052dc[_0x2117ba(0xee)]&&_0x5052dc[_0x2117ba(0xee)][_0x2117ba(0xd1)]()['includes'](_0x2117ba(0xe8));_0x452ce9&&(_0x48f8db+=(_0x5052dc[_0x2117ba(0xed)]||0x0)*(_0x8cff4e[_0x2117ba(0xf4)]||0x1));}}const _0x1fabc7=await inmateModel[_0x2117ba(0xcf)]({'inmateId':_0x2e97a6});if(!_0x1fabc7)return{'status':![],'message':_0x2117ba(0xd7)};if(_0x1fabc7[_0x2117ba(0xdf)]==='true')return{'status':![],'message':_0x2117ba(0xcd)+_0x1fabc7['inmateId']+_0x2117ba(0xe5)};const _0xedac4=0x1f4;if(_0x48f8db>_0xedac4)return{'status':![],'message':'Recharge\x20limit\x20exceeded.\x20Limit:\x20₹'+_0xedac4+_0x2117ba(0xe3)+_0x48f8db};return{'status':!![],'message':_0x2117ba(0xdb)};}catch(_0x6eb8f3){return console[_0x2117ba(0xeb)]('checkProductsLimit\x20error:',_0x6eb8f3),{'status':![],'message':_0x2117ba(0xdd)};}};