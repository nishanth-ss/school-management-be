const a9_0x1833a0=a9_0x97c3;function a9_0x5b65(){const _0x584bea=['post','status','username','send','76304IARNFo','isArray','buffer','<><>user','internal\x20server\x20down','message','pow','face\x20registered\x20successfully','fullname','loginFaceID','now','<><>distance','http://127.0.0.1:5001/encode','findByIdAndUpdate','_id','338060mimFUV','embedding','length','1924824zlOEpo','response','axios','getHeaders','role','5vVfzLO','json','file','4yMyMnn','../model/userModel','subscription','6851QHQNgC','log','data','mimetype','subscriptionEnd','696fQoPOS','sqrt','image','student','Image\x20is\x20required','242451YCAufZ','JWT_SECRET','24h','append','registerFaceID','User\x20subscription\x20has\x20expired','jsonwebtoken','63vWlyNv','Face\x20matched','originalname','find','sign','No\x20matching\x20face\x20found','415975VBdruB','descriptor','15252iRznnG','8fUymdO','1242YbgYjP'];a9_0x5b65=function(){return _0x584bea;};return a9_0x5b65();}function a9_0x97c3(_0x3ad9a0,_0x30a081){_0x3ad9a0=_0x3ad9a0-0x10a;const _0x5b65bc=a9_0x5b65();let _0x97c3a3=_0x5b65bc[_0x3ad9a0];return _0x97c3a3;}(function(_0x80be1a,_0x17513b){const _0xf3a35e=a9_0x97c3,_0x6697ca=_0x80be1a();while(!![]){try{const _0x285d1f=parseInt(_0xf3a35e(0x13a))/0x1*(parseInt(_0xf3a35e(0x117))/0x2)+-parseInt(_0xf3a35e(0x135))/0x3*(-parseInt(_0xf3a35e(0x11f))/0x4)+parseInt(_0xf3a35e(0x114))/0x5*(parseInt(_0xf3a35e(0x10f))/0x6)+parseInt(_0xf3a35e(0x131))/0x7*(parseInt(_0xf3a35e(0x134))/0x8)+parseInt(_0xf3a35e(0x12b))/0x9*(parseInt(_0xf3a35e(0x10c))/0xa)+parseInt(_0xf3a35e(0x124))/0xb+-parseInt(_0xf3a35e(0x133))/0xc*(parseInt(_0xf3a35e(0x11a))/0xd);if(_0x285d1f===_0x17513b)break;else _0x6697ca['push'](_0x6697ca['shift']());}catch(_0x48188c){_0x6697ca['push'](_0x6697ca['shift']());}}}(a9_0x5b65,0x2f4cb));const axios=require(a9_0x1833a0(0x111)),FormData=require('form-data'),userModel=require(a9_0x1833a0(0x118)),jwt=require(a9_0x1833a0(0x12a));function euclideanDistance(_0x2d562f,_0x5e1774){const _0x5e40f8=a9_0x1833a0;let _0x5ab836=0x0;for(let _0x42f7c6=0x0;_0x42f7c6<_0x2d562f[_0x5e40f8(0x10e)];_0x42f7c6++){_0x5ab836+=Math[_0x5e40f8(0x140)](_0x2d562f[_0x42f7c6]-_0x5e1774[_0x42f7c6],0x2);}return Math[_0x5e40f8(0x120)](_0x5ab836);}const euclideanDistanceVerify=(_0x2b25a9,_0xc8d0bb)=>{const _0x24e102=a9_0x1833a0;if(_0x2b25a9[_0x24e102(0x10e)]!==_0xc8d0bb[_0x24e102(0x10e)])return Infinity;let _0xbf29fe=0x0;for(let _0x2b69d1=0x0;_0x2b69d1<_0x2b25a9[_0x24e102(0x10e)];_0x2b69d1++){_0xbf29fe+=(_0x2b25a9[_0x2b69d1]-_0xc8d0bb[_0x2b69d1])**0x2;}return Math[_0x24e102(0x120)](_0xbf29fe);};exports[a9_0x1833a0(0x128)]=async(_0x5a3d50,_0x79ef46)=>{const _0x211bd0=a9_0x1833a0;try{const {userId:_0x2db5e0}=_0x5a3d50['body'];console[_0x211bd0(0x11b)](_0x5a3d50[_0x211bd0(0x116)]);if(!_0x5a3d50[_0x211bd0(0x116)])return _0x79ef46['status'](0x190)[_0x211bd0(0x115)]({'status':![],'message':_0x211bd0(0x123)});const _0x124df5=new FormData();_0x124df5[_0x211bd0(0x127)](_0x211bd0(0x121),_0x5a3d50[_0x211bd0(0x116)][_0x211bd0(0x13c)],{'filename':_0x5a3d50[_0x211bd0(0x116)][_0x211bd0(0x12d)],'contentType':_0x5a3d50['file']['mimetype']});const _0x1157af=await axios[_0x211bd0(0x136)](_0x211bd0(0x146),_0x124df5,{'headers':{..._0x124df5[_0x211bd0(0x112)]()}}),_0xfa98b7=_0x1157af[_0x211bd0(0x11c)]['embedding'],_0x146934=await userModel[_0x211bd0(0x12e)]({'descriptor':{'$exists':!![],'$ne':[]}},{'descriptor':0x1,'username':0x1,'inmateId':0x1});for(const _0x47e04b of _0x146934){if(!_0x47e04b[_0x211bd0(0x132)]||!Array[_0x211bd0(0x13b)](_0x47e04b[_0x211bd0(0x132)])||_0x47e04b['descriptor'][_0x211bd0(0x10e)]===0x0)continue;const _0x18ffc4=euclideanDistance(_0x47e04b[_0x211bd0(0x132)],_0xfa98b7);if(_0x18ffc4<0.4)return console[_0x211bd0(0x11b)](_0x211bd0(0x13d),_0x47e04b),_0x79ef46[_0x211bd0(0x137)](0x199)['json']({'status':![],'message':'Face\x20already\x20registered\x20with\x20another\x20user'});}return await userModel[_0x211bd0(0x10a)](_0x2db5e0,{'descriptor':_0xfa98b7}),_0x79ef46[_0x211bd0(0x115)]({'status':!![],'message':_0x211bd0(0x141)});}catch(_0x5b994d){if(_0x5b994d&&_0x5b994d[_0x211bd0(0x110)]&&_0x5b994d['response'][_0x211bd0(0x137)]===0x190)return _0x79ef46[_0x211bd0(0x137)](0x1f4)[_0x211bd0(0x139)]({'status':![],'message':''+_0x5b994d['response'][_0x211bd0(0x11c)][_0x211bd0(0x13f)]});return _0x79ef46[_0x211bd0(0x137)](0x1f4)[_0x211bd0(0x139)]({'status':![],'message':_0x211bd0(0x13e),'error':_0x5b994d[_0x211bd0(0x13f)]});}},exports[a9_0x1833a0(0x143)]=async(_0x214548,_0x4d06ae)=>{const _0x3c5151=a9_0x1833a0;try{if(!_0x214548[_0x3c5151(0x116)])return _0x4d06ae['status'](0x190)[_0x3c5151(0x115)]({'status':![],'message':_0x3c5151(0x123)});const _0x3390c1=new FormData();_0x3390c1[_0x3c5151(0x127)](_0x3c5151(0x121),_0x214548['file'][_0x3c5151(0x13c)],{'filename':_0x214548[_0x3c5151(0x116)][_0x3c5151(0x12d)],'contentType':_0x214548['file'][_0x3c5151(0x11d)]});const _0x297338=await axios[_0x3c5151(0x136)]('http://127.0.0.1:5001/encode',_0x3390c1,{'headers':_0x3390c1[_0x3c5151(0x112)]()}),_0x8f0513=_0x297338['data'][_0x3c5151(0x10d)],_0x4af707=await userModel[_0x3c5151(0x12e)]({'descriptor':{'$exists':!![],'$ne':[]}},{'descriptor':0x1,'username':0x1,'fullname':0x1,'role':0x1,'subscription':0x1,'subscriptionEnd':0x1});for(const _0x2fdc71 of _0x4af707){const _0x421750=euclideanDistanceVerify(_0x2fdc71[_0x3c5151(0x132)]||[],_0x8f0513);if(_0x421750<7.5){console[_0x3c5151(0x11b)](_0x3c5151(0x145),_0x421750),console['log'](_0x3c5151(0x13d),_0x2fdc71);if(_0x2fdc71[_0x3c5151(0x113)]===_0x3c5151(0x122)){_0x2fdc71[_0x3c5151(0x119)]&&_0x2fdc71[_0x3c5151(0x11e)]<=Date[_0x3c5151(0x144)]()&&(_0x2fdc71[_0x3c5151(0x119)]=![],await _0x2fdc71['save']());if(!_0x2fdc71['subscription'])return _0x4d06ae['status'](0x193)[_0x3c5151(0x115)]({'status':![],'user':{'id':_0x2fdc71[_0x3c5151(0x10b)],'username':_0x2fdc71[_0x3c5151(0x138)],'fullName':_0x2fdc71[_0x3c5151(0x142)],'role':_0x2fdc71['role'],'subscription':_0x2fdc71[_0x3c5151(0x119)]},'message':_0x3c5151(0x129)});}const _0x250aea=jwt[_0x3c5151(0x12f)]({'id':_0x2fdc71['_id'],'username':_0x2fdc71[_0x3c5151(0x138)],'role':_0x2fdc71[_0x3c5151(0x113)]},process['env'][_0x3c5151(0x125)],{'expiresIn':_0x3c5151(0x126)});return _0x4d06ae[_0x3c5151(0x115)]({'status':!![],'message':_0x3c5151(0x12c),'token':_0x250aea,'user':{'id':_0x2fdc71[_0x3c5151(0x10b)],'username':_0x2fdc71[_0x3c5151(0x138)],'fullName':_0x2fdc71['fullname'],'role':_0x2fdc71[_0x3c5151(0x113)],'subscription':_0x2fdc71[_0x3c5151(0x119)]}});}}return _0x4d06ae[_0x3c5151(0x137)](0x191)[_0x3c5151(0x115)]({'status':![],'message':_0x3c5151(0x130)});}catch(_0x5b53b1){console['error']('loginFaceID\x20error:',_0x5b53b1);if(_0x5b53b1&&_0x5b53b1[_0x3c5151(0x110)]&&_0x5b53b1[_0x3c5151(0x110)][_0x3c5151(0x137)]===0x190)return _0x4d06ae[_0x3c5151(0x137)](0x190)[_0x3c5151(0x115)]({'status':![],'message':_0x5b53b1[_0x3c5151(0x110)][_0x3c5151(0x11c)][_0x3c5151(0x13f)]});return _0x4d06ae[_0x3c5151(0x137)](0x1f4)[_0x3c5151(0x115)]({'status':![],'message':'Internal\x20server\x20error','error':_0x5b53b1[_0x3c5151(0x13f)]});}};