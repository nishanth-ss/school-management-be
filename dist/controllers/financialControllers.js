const a11_0x58ad1a=a11_0x294a;function a11_0x131a(){const _0x385fd5=['Invalid\x20transaction\x20type','student_id','params','ID\x20is\x20missing','Financial\x20successfully\x20fetched','Failed\x20to\x20export\x20wages\x20CSV','9UcnbGD','Created\x20','user','json','3591430oWbAKo','UPDATE','current_balace','sort','map','Insufficient\x20balance\x20for\x20withdrawal','depositAmount','Type\x20is\x20missing\x20or\x20incorrect','ObjectId','custodyType','setHeader','../model/financialModel','student_name','exports','Financial','$student_id','No\x20wage\x20records\x20found\x20to\x20export','Missing\x20required\x20fields\x20for\x20wages','Content-Disposition','text/csv','\x20transaction\x20successfully\x20created','created_at','Missing\x20required\x20fields\x20for\x20withdrawal','âŒ\x20Error\x20in\x20createFinancial:','_id','inmateId','4pmmRmc','registration_number','end','4961435zTuldv','aggregate','studentId','message','Financial\x20','localeCompare','depositor_name','../utils/inmateTransactionLimiter','withdrawal','../model/departmentModel','Invalid\x20ID\x20format','length','\x20transaction\x20for\x20student\x20','balance','Types','Financial\x20successfully\x20deleted','deposite_amount','findById','transaction','error','depositedBy','current_balance','mongoose','../utils/auditlogger','DELETE','findByIdAndUpdate','Missing\x20required\x20fields\x20for\x20deposit','type','../model/studentModel','Missing\x20required\x20fields','\x20record\x20for\x20inmate\x20','populate','No\x20data\x20found','find','students','wageAmount','Student\x20not\x20found','WEEKLY','Content-Type','toObject','contactNumber','3495009KabvsK','Inmate\x20not\x20found','createdAt','findOne','attachment;\x20filename=wages.csv','contact_number','student','CREATE','username','Deleted\x20financial\x20record\x20for\x20inmate\x20','\x20successfully\x20created','Internal\x20server\x20error','wages','Financial\x20update\x20successfully','Updated\x20financial\x20record\x20for\x20inmate\x20','5872184ePyhBg','7243628pKKfpv','deposit','save','format','Failed\x20to\x20export\x20wages\x20data','send','5602575MDENwB','16AKiYzk','6UvFYjC','isValid','query','moment','json2csv','16342UvkzUQ','body','csv','Transaction\x20type\x20is\x20required','YYYY-MM-DD\x20HH:mm:ss','status'];a11_0x131a=function(){return _0x385fd5;};return a11_0x131a();}(function(_0x472b76,_0x2fc3bb){const _0x25062b=a11_0x294a,_0x6e718a=_0x472b76();while(!![]){try{const _0x51e3c3=-parseInt(_0x25062b(0x1f4))/0x1*(parseInt(_0x25062b(0x1fa))/0x2)+-parseInt(_0x25062b(0x1dd))/0x3*(parseInt(_0x25062b(0x224))/0x4)+parseInt(_0x25062b(0x227))/0x5*(parseInt(_0x25062b(0x1f5))/0x6)+parseInt(_0x25062b(0x1ed))/0x7+parseInt(_0x25062b(0x1ec))/0x8+-parseInt(_0x25062b(0x206))/0x9*(parseInt(_0x25062b(0x20a))/0xa)+-parseInt(_0x25062b(0x1f3))/0xb;if(_0x51e3c3===_0x2fc3bb)break;else _0x6e718a['push'](_0x6e718a['shift']());}catch(_0x554077){_0x6e718a['push'](_0x6e718a['shift']());}}}(a11_0x131a,0x91bab));const FinancialSchema=require(a11_0x58ad1a(0x215)),InmateSchema=require(a11_0x58ad1a(0x1d0)),mongoose=require(a11_0x58ad1a(0x1ca)),logAudit=require(a11_0x58ad1a(0x1cb)),{Parser}=require(a11_0x58ad1a(0x1f9)),{checkTransactionLimit}=require(a11_0x58ad1a(0x1bb)),inmateModel=require('../model/studentModel'),departmentModel=require(a11_0x58ad1a(0x1bd)),studentModel=require('../model/studentModel'),financialModel=require(a11_0x58ad1a(0x215)),moment=require(a11_0x58ad1a(0x1f8)),downloadWagesCSV1=async(_0x2e5410,_0x58d1fb)=>{const _0x54d120=a11_0x58ad1a;try{const _0x25c154=await studentModel[_0x54d120(0x1d5)]();if(!_0x25c154||_0x25c154[_0x54d120(0x1bf)]===0x0)return _0x58d1fb[_0x54d120(0x1ff)](0x194)[_0x54d120(0x209)]({'message':_0x54d120(0x21a)});const _0x352215=_0x25c154[_0x54d120(0x20e)](_0x22acb8=>({'registration_number':_0x22acb8[_0x54d120(0x225)],'student_name':_0x22acb8[_0x54d120(0x216)],'custodyType':_0x22acb8[_0x54d120(0x213)],'wageAmount':0x0,'hoursWorked':0x0,'transaction':_0x54d120(0x1d9),'type':_0x54d120(0x1e9)})),_0x1d2b9a=[_0x54d120(0x1b6),_0x54d120(0x213),_0x54d120(0x1d7),'hoursWorked',_0x54d120(0x1c6),_0x54d120(0x1cf)],_0x1419d5=new Parser({'fields':_0x1d2b9a}),_0x435c79=_0x1419d5['parse'](_0x352215);_0x58d1fb['setHeader'](_0x54d120(0x21c),_0x54d120(0x1e1)),_0x58d1fb['setHeader'](_0x54d120(0x1da),'text/csv'),_0x58d1fb[_0x54d120(0x1ff)](0xc8)['end'](_0x435c79);}catch(_0x497f97){_0x58d1fb['status'](0x1f4)[_0x54d120(0x209)]({'message':_0x54d120(0x205),'error':_0x497f97['message']});}},downloadWagesCSV2=async(_0x377752,_0x100292)=>{const _0x40daed=a11_0x58ad1a;try{const {student_id:_0x3e05c4,format:_0x4a745e}=_0x377752[_0x40daed(0x1f7)];let _0x3a8ef9;_0x3e05c4?(_0x3a8ef9=await financialModel[_0x40daed(0x1d5)]({'student_id':_0x3e05c4})[_0x40daed(0x1d3)]('student_id'),_0x3a8ef9[_0x40daed(0x20d)]((_0x98d66b,_0x5632aa)=>_0x98d66b[_0x40daed(0x201)][_0x40daed(0x225)][_0x40daed(0x1b9)](_0x5632aa[_0x40daed(0x201)][_0x40daed(0x225)]))):_0x3a8ef9=await financialModel['aggregate']([{'$lookup':{'from':_0x40daed(0x1d6),'localField':_0x40daed(0x201),'foreignField':_0x40daed(0x222),'as':_0x40daed(0x201)}},{'$unwind':_0x40daed(0x219)},{'$sort':{'student.registration_number':0x1}}]);if(!_0x3a8ef9||_0x3a8ef9[_0x40daed(0x1bf)]===0x0)return _0x100292[_0x40daed(0x1ff)](0x194)[_0x40daed(0x209)]({'message':'No\x20wage\x20records\x20found\x20to\x20export'});const _0x5e246c=_0x3a8ef9['map'](_0x4a11b6=>({'registration_number':_0x4a11b6[_0x40daed(0x201)][_0x40daed(0x225)],'student_name':_0x4a11b6[_0x40daed(0x201)][_0x40daed(0x216)],'depositAmount':_0x4a11b6['depositAmount'],'current_balace':_0x4a11b6[_0x40daed(0x201)][_0x40daed(0x1c4)],'depositor_name':_0x4a11b6[_0x40daed(0x1c8)],'contact_number':_0x4a11b6['contactNumber'],'created_at':moment(_0x4a11b6['createdAt'])['format'](_0x40daed(0x1fe))})),_0x279158=[_0x40daed(0x225),_0x40daed(0x216),_0x40daed(0x210),_0x40daed(0x20c),'depositor_name',_0x40daed(0x1e2),_0x40daed(0x21f)],_0x411be0=new Parser({'fields':_0x279158}),_0x54ebb5=_0x411be0['parse'](_0x5e246c);_0x100292[_0x40daed(0x214)](_0x40daed(0x21c),_0x40daed(0x1e1)),_0x100292[_0x40daed(0x214)]('Content-Type',_0x40daed(0x21d)),_0x100292[_0x40daed(0x1ff)](0xc8)['end'](_0x54ebb5),_0x100292[_0x40daed(0x1ff)](0xc8)['send'](_0x40daed(0x1fc));}catch(_0x489f4a){_0x100292['status'](0x1f4)[_0x40daed(0x209)]({'message':_0x40daed(0x205),'error':_0x489f4a[_0x40daed(0x1b7)]});}},downloadWagesCSV=async(_0xa04624,_0x3c561f)=>{const _0x5ffaf9=a11_0x58ad1a;try{const {student_id:_0x35c9b4,format:_0x465973}=_0xa04624['query'];let _0x90cca0;_0x35c9b4?(_0x90cca0=await financialModel[_0x5ffaf9(0x1d5)]({'student_id':_0x35c9b4})[_0x5ffaf9(0x1d3)](_0x5ffaf9(0x201)),_0x90cca0[_0x5ffaf9(0x20d)]((_0x5c1df4,_0x76776a)=>_0x5c1df4[_0x5ffaf9(0x201)][_0x5ffaf9(0x225)][_0x5ffaf9(0x1b9)](_0x76776a[_0x5ffaf9(0x201)]['registration_number']))):_0x90cca0=await financialModel[_0x5ffaf9(0x228)]([{'$lookup':{'from':_0x5ffaf9(0x1d6),'localField':_0x5ffaf9(0x201),'foreignField':_0x5ffaf9(0x222),'as':_0x5ffaf9(0x201)}},{'$unwind':_0x5ffaf9(0x219)},{'$sort':{'student_id.registration_number':0x1}}]);if(!_0x90cca0||_0x90cca0[_0x5ffaf9(0x1bf)]===0x0)return _0x3c561f['status'](0x194)['json']({'message':_0x5ffaf9(0x21a)});const _0x555ba6=_0x90cca0['map'](_0xfc8106=>({'registration_number':_0xfc8106[_0x5ffaf9(0x201)][_0x5ffaf9(0x225)],'student_name':_0xfc8106[_0x5ffaf9(0x201)][_0x5ffaf9(0x216)],'depositAmount':_0xfc8106[_0x5ffaf9(0x210)],'current_balance':_0xfc8106[_0x5ffaf9(0x201)]['deposite_amount'],'depositor_name':_0xfc8106[_0x5ffaf9(0x1c8)],'contact_number':_0xfc8106[_0x5ffaf9(0x1dc)],'created_at':moment(_0xfc8106[_0x5ffaf9(0x1df)])[_0x5ffaf9(0x1f0)](_0x5ffaf9(0x1fe))}));if(_0x465973&&_0x465973['toLowerCase']()===_0x5ffaf9(0x209))return _0x3c561f['status'](0xc8)[_0x5ffaf9(0x209)]({'success':!![],'count':_0x555ba6[_0x5ffaf9(0x1bf)],'data':_0x555ba6});const _0x39936c=['registration_number',_0x5ffaf9(0x216),_0x5ffaf9(0x210),_0x5ffaf9(0x1c9),_0x5ffaf9(0x1ba),'contact_number',_0x5ffaf9(0x21f)],_0x467115=new Parser({'fields':_0x39936c}),_0x5dda82=_0x467115['parse'](_0x555ba6);_0x3c561f['setHeader'](_0x5ffaf9(0x21c),_0x5ffaf9(0x1e1)),_0x3c561f[_0x5ffaf9(0x214)](_0x5ffaf9(0x1da),'text/csv'),_0x3c561f['status'](0xc8)[_0x5ffaf9(0x226)](_0x5dda82);}catch(_0xd71b9f){_0x3c561f[_0x5ffaf9(0x1ff)](0x1f4)[_0x5ffaf9(0x209)]({'message':_0x5ffaf9(0x1f1),'error':_0xd71b9f[_0x5ffaf9(0x1b7)]});}},createFinancial1=async(_0x128320,_0x43b3be)=>{const _0x1a178a=a11_0x58ad1a;try{const {inmateId:_0x999889,workAssignId:_0x4b9d54,hoursWorked:_0x148df0,wageAmount:_0x5dfb2c,transaction:_0x5b6dcb,depositType:_0x174479,status:_0x5d3a1e,relationShipId:_0x42d676,type:_0x3f2518,depositAmount:_0x14e15f}=_0x128320['body'];if(!depositLim[_0x1a178a(0x1ff)])return _0x43b3be[_0x1a178a(0x1ff)](0x190)[_0x1a178a(0x1f2)]({'success':![],'message':depositLim[_0x1a178a(0x1b7)]});if(_0x3f2518==_0x1a178a(0x1e9)){if(!_0x999889||!_0x4b9d54||!_0x148df0||!_0x5dfb2c||!_0x3f2518||!_0x5b6dcb)return _0x43b3be['status'](0x190)[_0x1a178a(0x209)]({'message':_0x1a178a(0x1d1)});}else{if(_0x3f2518==_0x1a178a(0x1ee)){if(!_0x999889||!_0x174479||!_0x3f2518||!_0x14e15f||!_0x42d676)return _0x43b3be[_0x1a178a(0x1ff)](0x190)[_0x1a178a(0x209)]({'message':_0x1a178a(0x1d1)});}else{if(_0x3f2518==_0x1a178a(0x1bc)){if(!_0x999889||!_0x174479||!_0x3f2518||!_0x14e15f||!_0x42d676)return _0x43b3be[_0x1a178a(0x1ff)](0x190)[_0x1a178a(0x209)]({'message':'Missing\x20required\x20fields'});}else return _0x43b3be['status'](0x190)['json']({'message':_0x1a178a(0x211)});}}const _0x4fb427=await InmateSchema[_0x1a178a(0x1e0)]({'inmateId':_0x999889});if(!_0x4fb427)return _0x43b3be[_0x1a178a(0x1ff)](0x194)[_0x1a178a(0x209)]({'message':_0x1a178a(0x1de)});let _0x21a551=0x0;if(_0x3f2518==='wages')_0x21a551=_0x5dfb2c||0x0;else{if(_0x3f2518===_0x1a178a(0x1ee))_0x21a551=_0x14e15f||0x0;else _0x3f2518==='withdrawal'&&(_0x21a551=_0x14e15f||0x0);}_0x3f2518===_0x1a178a(0x1bc)?_0x4fb427[_0x1a178a(0x1c1)]-=_0x21a551:_0x4fb427['balance']+=_0x21a551;await _0x4fb427[_0x1a178a(0x1ef)]();const _0x3904ee=new FinancialSchema({'inmateId':_0x999889,'custodyType':_0x4fb427[_0x1a178a(0x213)],'workAssignId':_0x4b9d54,'hoursWorked':_0x148df0,'wageAmount':_0x5dfb2c,'transaction':_0x5b6dcb,'status':_0x5d3a1e,'type':_0x3f2518,'relationShipId':_0x42d676,'depositAmount':_0x14e15f,'depositType':_0x174479}),_0xd9af80=await _0x3904ee[_0x1a178a(0x1ef)]();await logAudit({'userId':_0x128320['user']['id'],'username':_0x128320[_0x1a178a(0x208)][_0x1a178a(0x1e5)],'action':_0x1a178a(0x1e4),'targetModel':_0x1a178a(0x218),'targetId':_0xd9af80[_0x1a178a(0x222)],'description':'Created\x20'+_0x3f2518+_0x1a178a(0x1d2)+_0x999889,'changes':{..._0x128320[_0x1a178a(0x1fb)],'custodyType':_0x4fb427[_0x1a178a(0x213)]}}),_0x43b3be['status'](0xc9)[_0x1a178a(0x209)]({'success':!![],'data':_0xd9af80,'message':'Financial\x20'+_0x3f2518+_0x1a178a(0x1e7)});}catch(_0x5d53f7){_0x43b3be[_0x1a178a(0x1ff)](0x1f4)[_0x1a178a(0x209)]({'success':![],'message':_0x1a178a(0x1e8),'error':_0x5d53f7['message']});}},createFinancial=async(_0x46d9b8,_0x232e45)=>{const _0x2e1433=a11_0x58ad1a;try{const {student_id:_0x47d106,hoursWorked:_0x33852d,wageAmount:_0x39b0f9,transaction:_0x176735,depositType:_0x547de5,status:_0x280f72,relationShipId:_0x5c0586,type:_0x18d8b3,depositAmount:_0x58725b,depositedBy:_0x2d8ba8,depositedById:_0x4d95d6,contactNumber:_0x1afcb9,remarks:_0x1ba03d}=_0x46d9b8['body'];if(!_0x18d8b3)return _0x232e45[_0x2e1433(0x1ff)](0x190)['json']({'success':![],'message':_0x2e1433(0x1fd)});if(_0x18d8b3===_0x2e1433(0x1e9)){if(!_0x47d106||!_0x33852d||!_0x39b0f9||!_0x176735)return _0x232e45['status'](0x190)[_0x2e1433(0x209)]({'success':![],'message':_0x2e1433(0x21b)});}else{if(_0x18d8b3===_0x2e1433(0x1ee)){if(!_0x47d106||!_0x547de5||!_0x58725b||!_0x5c0586||!_0x2d8ba8)return _0x232e45[_0x2e1433(0x1ff)](0x190)[_0x2e1433(0x209)]({'success':![],'message':_0x2e1433(0x1ce)});}else{if(_0x18d8b3===_0x2e1433(0x1bc)){if(!_0x47d106||!_0x547de5||!_0x58725b||!_0x5c0586)return _0x232e45[_0x2e1433(0x1ff)](0x190)[_0x2e1433(0x209)]({'success':![],'message':_0x2e1433(0x220)});}else return _0x232e45[_0x2e1433(0x1ff)](0x190)[_0x2e1433(0x209)]({'success':![],'message':_0x2e1433(0x200)});}}const _0x131304=await studentModel[_0x2e1433(0x1c5)](_0x47d106);if(!_0x131304)return _0x232e45[_0x2e1433(0x1ff)](0x194)['json']({'success':![],'message':_0x2e1433(0x1d8)});let _0x5e7970=0x0;if(_0x18d8b3===_0x2e1433(0x1e9))_0x5e7970=Number(_0x39b0f9)||0x0,_0x131304[_0x2e1433(0x1c1)]+=_0x5e7970;else{if(_0x18d8b3===_0x2e1433(0x1ee))_0x5e7970=Number(_0x58725b)||0x0,_0x131304[_0x2e1433(0x1c1)]+=_0x5e7970;else{if(_0x18d8b3===_0x2e1433(0x1bc)){_0x5e7970=Number(_0x58725b)||0x0;if(_0x131304[_0x2e1433(0x1c1)]<_0x5e7970)return _0x232e45[_0x2e1433(0x1ff)](0x190)[_0x2e1433(0x209)]({'success':![],'message':_0x2e1433(0x20f)});_0x131304[_0x2e1433(0x1c1)]-=_0x5e7970;}}}await _0x131304[_0x2e1433(0x1ef)]();const _0x4fef10=new FinancialSchema({'student_id':_0x47d106,'custodyType':_0x131304['custodyType']||_0x2e1433(0x1e3),'hoursWorked':_0x33852d,'wageAmount':_0x39b0f9,'transaction':_0x176735,'status':_0x280f72,'type':_0x18d8b3,'relationShipId':_0x5c0586,'depositAmount':_0x58725b,'depositType':_0x547de5,'depositedBy':_0x2d8ba8,'depositedById':_0x4d95d6||null,'contactNumber':_0x1afcb9||null,'remarks':_0x1ba03d||null}),_0x402070=await _0x4fef10[_0x2e1433(0x1ef)]();if(_0x18d8b3===_0x2e1433(0x1ee)){const _0x1f4e8a=_0x131304[_0x2e1433(0x1c4)]+_0x58725b;await studentModel[_0x2e1433(0x1cd)](_0x47d106,{'deposite_amount':_0x1f4e8a});}await logAudit({'userId':_0x46d9b8[_0x2e1433(0x208)]['id'],'username':_0x46d9b8[_0x2e1433(0x208)][_0x2e1433(0x1e5)],'action':_0x2e1433(0x1e4),'targetModel':_0x2e1433(0x218),'targetId':_0x402070[_0x2e1433(0x222)],'description':_0x2e1433(0x207)+_0x18d8b3+_0x2e1433(0x1c0)+_0x47d106,'changes':{..._0x46d9b8['body'],'custodyType':_0x131304[_0x2e1433(0x213)],'finalBalance':_0x131304[_0x2e1433(0x1c1)]}}),_0x232e45[_0x2e1433(0x1ff)](0xc9)[_0x2e1433(0x209)]({'success':!![],'data':_0x402070,'message':_0x2e1433(0x1b8)+_0x18d8b3+_0x2e1433(0x21e)});}catch(_0x3dc60f){console[_0x2e1433(0x1c7)](_0x2e1433(0x221),_0x3dc60f),_0x232e45[_0x2e1433(0x1ff)](0x1f4)['json']({'success':![],'message':_0x2e1433(0x1e8),'error':_0x3dc60f[_0x2e1433(0x1b7)]});}},getFinancial=async(_0x413dc4,_0x5c7124)=>{const _0x38e5a4=a11_0x58ad1a;try{const _0x198082=await FinancialSchema[_0x38e5a4(0x1d5)]()[_0x38e5a4(0x20d)]({'createdAt':-0x1});if(!_0x198082)return _0x5c7124[_0x38e5a4(0x1ff)](0x194)['json']({'success':![],'message':'No\x20data\x20found','data':[]});_0x5c7124['status'](0xc8)['json']({'success':!![],'data':_0x198082,'message':_0x38e5a4(0x204)});}catch(_0x5c44f6){_0x5c7124[_0x38e5a4(0x1ff)](0x1f4)['json']({'success':![],'message':_0x38e5a4(0x1e8),'error':_0x5c44f6[_0x38e5a4(0x1b7)]});}},getFinancialID=async(_0xe76b6f,_0x360f5b)=>{const _0x435872=a11_0x58ad1a;try{const {id:_0x37c52f}=_0xe76b6f[_0x435872(0x202)];if(!_0x37c52f)return _0x360f5b[_0x435872(0x1ff)](0x190)[_0x435872(0x209)]({'message':'ID\x20is\x20missing'});if(!mongoose[_0x435872(0x1c2)][_0x435872(0x212)][_0x435872(0x1f6)](_0x37c52f))return _0x360f5b['status'](0x190)[_0x435872(0x209)]({'message':'Invalid\x20ID\x20format'});const _0xcf39e3=await FinancialSchema[_0x435872(0x1c5)](_0x37c52f);if(!_0xcf39e3)return _0x360f5b[_0x435872(0x1ff)](0x194)[_0x435872(0x209)]({'message':_0x435872(0x1d4)});_0x360f5b[_0x435872(0x1ff)](0xc8)['json']({'success':!![],'data':_0xcf39e3,'message':_0x435872(0x204)});}catch(_0x267476){_0x360f5b[_0x435872(0x1ff)](0x1f4)['json']({'success':![],'message':_0x435872(0x1e8),'error':_0x267476['message']});}},updateFinancial=async(_0x2d0da1,_0x4829cc)=>{const _0x621fd8=a11_0x58ad1a;try{const {id:_0x14bc5d}=_0x2d0da1['params'],_0x1b9a81=_0x2d0da1['body'];if(!_0x14bc5d)return _0x4829cc[_0x621fd8(0x1ff)](0x190)['json']({'message':_0x621fd8(0x203)});if(!mongoose['Types'][_0x621fd8(0x212)][_0x621fd8(0x1f6)](_0x14bc5d))return _0x4829cc[_0x621fd8(0x1ff)](0x190)[_0x621fd8(0x209)]({'message':_0x621fd8(0x1be)});const _0x61f4b9=await FinancialSchema[_0x621fd8(0x1c5)](_0x14bc5d);if(!_0x61f4b9)return _0x4829cc[_0x621fd8(0x1ff)](0x194)[_0x621fd8(0x209)]({'message':_0x621fd8(0x1d4)});const _0x32f2ec=await FinancialSchema[_0x621fd8(0x1cd)](_0x14bc5d,_0x1b9a81,{'new':!![],'runValidators':!![]});if(!_0x32f2ec)return _0x4829cc[_0x621fd8(0x1ff)](0x194)[_0x621fd8(0x209)]({'message':_0x621fd8(0x1d4)});if(_0x61f4b9[_0x621fd8(0x1cf)]===_0x621fd8(0x1e9)||_0x61f4b9[_0x621fd8(0x1cf)]===_0x621fd8(0x1ee)){const _0x30e988=await InmateSchema['findOne']({'inmateId':_0x61f4b9['inmateId']});if(_0x30e988){let _0x3cc217=_0x61f4b9[_0x621fd8(0x1cf)]===_0x621fd8(0x1e9)?_0x61f4b9[_0x621fd8(0x1d7)]:_0x61f4b9[_0x621fd8(0x210)],_0x1a2889=_0x1b9a81['wageAmount']||_0x1b9a81['depositAmount']||0x0;const _0x3c4188=_0x1a2889-_0x3cc217;_0x30e988['balance']+=_0x3c4188,await _0x30e988[_0x621fd8(0x1ef)]();}}await logAudit({'userId':_0x2d0da1[_0x621fd8(0x208)]['id'],'username':_0x2d0da1[_0x621fd8(0x208)][_0x621fd8(0x1e5)],'action':_0x621fd8(0x20b),'targetModel':_0x621fd8(0x218),'targetId':_0x14bc5d,'description':_0x621fd8(0x1eb)+_0x32f2ec[_0x621fd8(0x223)],'changes':_0x32f2ec}),_0x4829cc[_0x621fd8(0x1ff)](0xc8)[_0x621fd8(0x209)]({'success':!![],'data':_0x32f2ec,'message':_0x621fd8(0x1ea)});}catch(_0x568277){_0x4829cc[_0x621fd8(0x1ff)](0x1f4)['json']({'success':![],'message':_0x621fd8(0x1e8),'error':_0x568277[_0x621fd8(0x1b7)]});}},deleteFinancial=async(_0x26498d,_0x1f7097)=>{const _0x4d1a16=a11_0x58ad1a;try{const {id:_0x39a09e}=_0x26498d[_0x4d1a16(0x202)];if(!_0x39a09e)return _0x1f7097[_0x4d1a16(0x1ff)](0x190)[_0x4d1a16(0x209)]({'message':_0x4d1a16(0x203)});if(!mongoose[_0x4d1a16(0x1c2)]['ObjectId'][_0x4d1a16(0x1f6)](_0x39a09e))return _0x1f7097[_0x4d1a16(0x1ff)](0x190)[_0x4d1a16(0x209)]({'message':_0x4d1a16(0x1be)});const _0x34e274=await FinancialSchema['findByIdAndDelete'](_0x39a09e);if(!_0x34e274)return _0x1f7097['status'](0x194)[_0x4d1a16(0x209)]({'message':_0x4d1a16(0x1d4)});await logAudit({'userId':_0x26498d['user']['id'],'username':_0x26498d[_0x4d1a16(0x208)][_0x4d1a16(0x1e5)],'action':_0x4d1a16(0x1cc),'targetModel':'Financial','targetId':_0x34e274[_0x4d1a16(0x222)],'description':_0x4d1a16(0x1e6)+_0x34e274[_0x4d1a16(0x223)],'changes':_0x34e274[_0x4d1a16(0x1db)]()}),_0x1f7097[_0x4d1a16(0x1ff)](0xc8)[_0x4d1a16(0x209)]({'success':!![],'message':_0x4d1a16(0x1c3)});}catch(_0x3eef35){_0x1f7097[_0x4d1a16(0x1ff)](0x1f4)[_0x4d1a16(0x209)]({'success':![],'message':_0x4d1a16(0x1e8),'error':_0x3eef35[_0x4d1a16(0x1b7)]});}},searchFinancial=async(_0x1b1742,_0x45022b)=>{const _0x3243de=a11_0x58ad1a;try{const {query:_0x57d1c5}=_0x1b1742[_0x3243de(0x1f7)];if(!_0x57d1c5||_0x57d1c5['trim']()==='')return _0x45022b[_0x3243de(0x1ff)](0x190)[_0x3243de(0x209)]({'message':'Search\x20query\x20is\x20required'});const _0x2fc731=new RegExp(_0x57d1c5,'i'),_0x8e7f45=await FinancialSchema[_0x3243de(0x1d5)]({'$or':[{'inmateId':_0x2fc731},{'firstName':_0x2fc731},{'lastName':_0x2fc731},{'cellNumber':_0x2fc731}]});_0x45022b['status'](0xc8)[_0x3243de(0x209)]({'success':!![],'data':_0x8e7f45});}catch(_0x441982){_0x45022b['status'](0x1f4)[_0x3243de(0x209)]({'success':![],'message':_0x3243de(0x1e8),'error':_0x441982[_0x3243de(0x1b7)]});}};function a11_0x294a(_0x251644,_0x443b0a){_0x251644=_0x251644-0x1b6;const _0x131a67=a11_0x131a();let _0x294a21=_0x131a67[_0x251644];return _0x294a21;}module[a11_0x58ad1a(0x217)]={'createFinancial':createFinancial,'getFinancial':getFinancial,'getFinancialID':getFinancialID,'updateFinancial':updateFinancial,'deleteFinancial':deleteFinancial,'searchFinancial':searchFinancial,'downloadWagesCSV':downloadWagesCSV};