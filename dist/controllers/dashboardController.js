const a7_0x4126f3=a7_0x1c7e;function a7_0x289a(){const _0x4f7b4b=['10KtJORy','4148342tLMbry','_id','status','all','populate','../model/studentModel','countDocuments','json','992211JCsjGb','5718NkbiKk','8MAtEPz','length','10120NwiixZ','price','sort','depositAmount','exports','map','5782992ckHbNU','POS','Financial','7BsiHQC','student_id','aggregate','inmateId','178YeHBMY','813FfQedq','products.productId','wageAmount','totalBalance','../model/tuckShopModel','reduce','2574jOFHOz','878540kMlusB','limit','../model/financialModel','../model/posShoppingCart','createdAt','custodyType','find','message','Failed\x20to\x20load\x20dashboard\x20data','totalAmount'];a7_0x289a=function(){return _0x4f7b4b;};return a7_0x289a();}(function(_0x215a71,_0x1320c6){const _0x2633cb=a7_0x1c7e,_0x1b21b1=_0x215a71();while(!![]){try{const _0x517a14=-parseInt(_0x2633cb(0x1b2))/0x1*(parseInt(_0x2633cb(0x1b1))/0x2)+-parseInt(_0x2633cb(0x1a0))/0x3+parseInt(_0x2633cb(0x1a2))/0x4*(parseInt(_0x2633cb(0x1b9))/0x5)+parseInt(_0x2633cb(0x1a1))/0x6*(-parseInt(_0x2633cb(0x1ad))/0x7)+-parseInt(_0x2633cb(0x1a4))/0x8*(-parseInt(_0x2633cb(0x1b8))/0x9)+-parseInt(_0x2633cb(0x1c3))/0xa*(-parseInt(_0x2633cb(0x1c4))/0xb)+-parseInt(_0x2633cb(0x1aa))/0xc;if(_0x517a14===_0x1320c6)break;else _0x1b21b1['push'](_0x1b21b1['shift']());}catch(_0x2be3b4){_0x1b21b1['push'](_0x1b21b1['shift']());}}}(a7_0x289a,0x31e4d));function a7_0x1c7e(_0x416a09,_0x5ad2fe){_0x416a09=_0x416a09-0x19e;const _0x289a93=a7_0x289a();let _0x1c7eec=_0x289a93[_0x416a09];return _0x1c7eec;}const Inmate=require(a7_0x4126f3(0x1c9)),POSShoppingCart=require(a7_0x4126f3(0x1bc)),Financial=require(a7_0x4126f3(0x1bb)),TuckShop=require(a7_0x4126f3(0x1b6)),inmateModel=require('../model/studentModel'),getDashboardData=async(_0x214f2e,_0x168e51)=>{const _0x416dec=a7_0x4126f3;try{const _0x428d62=new Date();_0x428d62['setHours'](0x0,0x0,0x0,0x0);const _0x7ec292=await Inmate[_0x416dec(0x19e)](),_0x3e4156=await Inmate[_0x416dec(0x1af)]([{'$group':{'_id':null,'totalBalance':{'$sum':'$balance'}}}]),_0x1c26d1=_0x3e4156[0x0]?.[_0x416dec(0x1b5)]||0x0,_0x526111=await POSShoppingCart[_0x416dec(0x1bf)]({'createdAt':{'$gte':_0x428d62}})[_0x416dec(0x1c8)](_0x416dec(0x1ae)),_0x15c5f4=_0x526111[_0x416dec(0x1b7)]((_0x547d2b,_0x440f77)=>_0x547d2b+_0x440f77[_0x416dec(0x1c2)],0x0),_0x66d35e=await TuckShop['find'](),_0x4797a4=_0x66d35e['reduce']((_0x4c1d30,_0x4a6167)=>_0x4c1d30+_0x4a6167[_0x416dec(0x1a5)]*_0x4a6167['stockQuantity'],0x0),_0x337f39=0x64,_0x4a7988=await Inmate[_0x416dec(0x1bf)]({'balance':{'$lt':_0x337f39}}),_0x403647=await Financial['find']({'createdAt':{'$gte':_0x428d62}})['populate'](_0x416dec(0x1ae)),_0x15d3ea=_0x403647[_0x416dec(0x1b7)]((_0x1810c9,_0x34c832)=>{const _0x50840a=_0x416dec;return _0x1810c9+(_0x34c832[_0x50840a(0x1a7)]||0x0)+(_0x34c832[_0x50840a(0x1b4)]||0x0);},0x0),_0x5d2178=await POSShoppingCart['find']()['sort']({'createdAt':-0x1})[_0x416dec(0x1ba)](0xa)[_0x416dec(0x1c8)](_0x416dec(0x1ae))[_0x416dec(0x1c8)](_0x416dec(0x1b3)),_0x78933d=await Financial[_0x416dec(0x1bf)]()['populate']('student_id')[_0x416dec(0x1a6)]({'createdAt':-0x1})[_0x416dec(0x1ba)](0xa),_0x1f38fe=await Promise[_0x416dec(0x1c7)](_0x5d2178[_0x416dec(0x1a9)](async _0x55c1ea=>{const _0x88e81a=_0x416dec,_0x426b5c=await inmateModel['findOne']({'inmateId':_0x55c1ea[_0x88e81a(0x1b0)]},{'custodyType':0x1,'_id':0x0}),_0xe1cff5=_0x55c1ea['toObject']?_0x55c1ea['toObject']():_0x55c1ea;return{'_id':_0x55c1ea[_0x88e81a(0x1c5)],'type':_0x88e81a(0x1ab),'totalAmount':_0x55c1ea[_0x88e81a(0x1c2)],'createdAt':_0x55c1ea[_0x88e81a(0x1bd)],'details':{..._0xe1cff5,'custodyType':_0x426b5c?.[_0x88e81a(0x1be)]||null}};})),_0x22a1bd=_0x78933d[_0x416dec(0x1a9)](_0x3daeb2=>({'_id':_0x3daeb2[_0x416dec(0x1c5)],'type':_0x416dec(0x1ac),'totalAmount':_0x3daeb2[_0x416dec(0x1b4)]||_0x3daeb2[_0x416dec(0x1a7)]||0x0,'createdAt':_0x3daeb2[_0x416dec(0x1bd)],'details':_0x3daeb2})),_0x225adb=[..._0x1f38fe,..._0x22a1bd]['sort']((_0x29cd05,_0x4ab0a0)=>new Date(_0x4ab0a0[_0x416dec(0x1bd)])-new Date(_0x29cd05[_0x416dec(0x1bd)]))['slice'](0x0,0x5);_0x168e51[_0x416dec(0x1c6)](0xc8)['json']({'success':!![],'data':{'totalInmates':_0x7ec292,'totalBalance':_0x1c26d1,'todayTransactionCount':_0x526111[_0x416dec(0x1a3)]+_0x403647['length'],'totalSalesToday':_0x15c5f4,'lowBalanceInmates':_0x4a7988,'tuckshop':{'totalItems':_0x66d35e['length'],'stockValue':_0x4797a4},'financial':{'todayFinancialCount':_0x403647[_0x416dec(0x1a3)],'totalFinancialToday':_0x15d3ea},'recentTransactions':_0x225adb}});}catch(_0x5d2946){_0x168e51[_0x416dec(0x1c6)](0x1f4)[_0x416dec(0x19f)]({'success':![],'message':_0x416dec(0x1c1),'error':_0x5d2946[_0x416dec(0x1c0)]});}};module[a7_0x4126f3(0x1a8)]={'getDashboardData':getDashboardData};