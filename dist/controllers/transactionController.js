const a18_0x4496fa=a18_0x22c5;(function(_0x1e9969,_0x5e3a72){const _0x1566c7=a18_0x22c5,_0x336961=_0x1e9969();while(!![]){try{const _0x12c693=parseInt(_0x1566c7(0x167))/0x1+-parseInt(_0x1566c7(0x16f))/0x2*(parseInt(_0x1566c7(0x190))/0x3)+-parseInt(_0x1566c7(0x16e))/0x4+parseInt(_0x1566c7(0x177))/0x5*(parseInt(_0x1566c7(0x16d))/0x6)+-parseInt(_0x1566c7(0x189))/0x7*(-parseInt(_0x1566c7(0x170))/0x8)+-parseInt(_0x1566c7(0x17f))/0x9+parseInt(_0x1566c7(0x166))/0xa*(parseInt(_0x1566c7(0x16c))/0xb);if(_0x12c693===_0x5e3a72)break;else _0x336961['push'](_0x336961['shift']());}catch(_0x5c762d){_0x336961['push'](_0x336961['shift']());}}}(a18_0x3ee3,0x80ec9));function a18_0x22c5(_0x55a840,_0x24deba){_0x55a840=_0x55a840-0x15c;const _0x3ee342=a18_0x3ee3();let _0x22c581=_0x3ee342[_0x55a840];return _0x22c581;}const POSShoppingCart=require(a18_0x4496fa(0x18d)),Financial=require(a18_0x4496fa(0x187)),inmateModel=require(a18_0x4496fa(0x160)),getTransactionsByRange1=async(_0x30a01c,_0x706c93)=>{const _0x23e59e=a18_0x4496fa;try{const {range:range=_0x23e59e(0x169),page:page=0x1,limit:limit=0xa}=_0x30a01c['query'],_0x1d6e59=new Date();let _0x352740;switch(range[_0x23e59e(0x165)]()){case _0x23e59e(0x169):_0x352740=new Date(_0x1d6e59[_0x23e59e(0x176)](0x0,0x0,0x0,0x0));break;case'weekly':_0x352740=new Date(),_0x352740[_0x23e59e(0x18c)](_0x1d6e59[_0x23e59e(0x173)]()-_0x1d6e59[_0x23e59e(0x179)]()),_0x352740['setHours'](0x0,0x0,0x0,0x0);break;case _0x23e59e(0x17a):_0x352740=new Date(_0x1d6e59[_0x23e59e(0x171)](),_0x1d6e59['getMonth'](),0x1);break;case _0x23e59e(0x161):_0x352740=new Date(_0x1d6e59['getFullYear'](),0x0,0x1);break;default:return _0x706c93[_0x23e59e(0x16b)](0x190)['json']({'success':![],'message':'Invalid\x20range.\x20Use\x20\x27daily\x27,\x20\x27weekly\x27,\x20\x27monthly\x27,\x20or\x20\x27yearly\x27.'});}const _0x146d84=(parseInt(page)-0x1)*parseInt(limit),_0x21325d=parseInt(limit),[_0x475092,_0x2888ca]=await Promise[_0x23e59e(0x162)]([POSShoppingCart[_0x23e59e(0x188)]({'createdAt':{'$gte':_0x352740}})['populate'](_0x23e59e(0x184))[_0x23e59e(0x180)](),Financial[_0x23e59e(0x188)]({'createdAt':{'$gte':_0x352740}})[_0x23e59e(0x186)]('workAssignId')[_0x23e59e(0x180)]()]);let _0x2787d0=[..._0x475092[_0x23e59e(0x17d)](_0x60d588=>({..._0x60d588,'source':_0x23e59e(0x18b)})),..._0x2888ca['map'](_0x456c91=>({..._0x456c91,'source':'FINANCIAL'}))];_0x2787d0[_0x23e59e(0x168)]((_0x3e1c22,_0x4be6bd)=>new Date(_0x4be6bd[_0x23e59e(0x18a)])-new Date(_0x3e1c22[_0x23e59e(0x18a)]));let _0xfacac3=_0x2787d0[_0x23e59e(0x185)](_0x146d84,_0x146d84+_0x21325d);_0xfacac3=await Promise[_0x23e59e(0x162)](_0xfacac3[_0x23e59e(0x17d)](async _0x34130a=>{const _0x39b8bb=_0x23e59e;if(_0x34130a[_0x39b8bb(0x15f)]===_0x39b8bb(0x18b)){const _0x318f8f=await inmateModel['findOne']({'inmateId':_0x34130a['inmateId']},{'custodyType':0x1,'_id':0x0})[_0x39b8bb(0x180)]();_0x318f8f&&(_0x34130a['custodyType']=_0x318f8f[_0x39b8bb(0x17c)]);}return _0x34130a;})),_0x706c93[_0x23e59e(0x16b)](0xc8)[_0x23e59e(0x178)]({'success':!![],'range':range,'count':_0x2787d0[_0x23e59e(0x18e)],'page':parseInt(page),'limit':_0x21325d,'totalPages':Math[_0x23e59e(0x174)](_0x2787d0[_0x23e59e(0x18e)]/_0x21325d),'transactions':_0xfacac3});}catch(_0x4fa999){_0x706c93[_0x23e59e(0x16b)](0x1f4)[_0x23e59e(0x178)]({'success':![],'message':_0x23e59e(0x164),'error':_0x4fa999[_0x23e59e(0x172)]});}},getTransactionsByRange=async(_0x4dd282,_0x490d4d)=>{const _0x2b100a=a18_0x4496fa;try{const {range:range=_0x2b100a(0x169),page:page=0x1,limit:limit=0xa}=_0x4dd282['query'],_0x4bf01d=new Date();let _0x4342cd;switch(range[_0x2b100a(0x165)]()){case _0x2b100a(0x169):_0x4342cd=new Date(),_0x4342cd[_0x2b100a(0x18c)](_0x4342cd[_0x2b100a(0x173)]()-0x1),_0x4342cd[_0x2b100a(0x176)](0x0,0x0,0x0,0x0);break;case _0x2b100a(0x181):const _0x1bb616=new Date();_0x4342cd=new Date(_0x1bb616[_0x2b100a(0x18c)](_0x1bb616[_0x2b100a(0x173)]()-_0x1bb616[_0x2b100a(0x179)]())),_0x4342cd[_0x2b100a(0x176)](0x0,0x0,0x0,0x0);break;case _0x2b100a(0x17a):_0x4342cd=new Date(_0x4bf01d[_0x2b100a(0x171)](),_0x4bf01d['getMonth'](),0x1);break;case _0x2b100a(0x161):_0x4342cd=new Date(_0x4bf01d[_0x2b100a(0x171)](),0x0,0x1);break;}const _0x42d04f=(parseInt(page)-0x1)*parseInt(limit),_0x378cb0=parseInt(limit),[_0x5466b9,_0x470987]=await Promise[_0x2b100a(0x162)]([POSShoppingCart[_0x2b100a(0x188)]({'createdAt':{'$gte':_0x4342cd}})['populate'](_0x2b100a(0x16a))[_0x2b100a(0x186)](_0x2b100a(0x184))[_0x2b100a(0x180)](),Financial['find']({'createdAt':{'$gte':_0x4342cd}})[_0x2b100a(0x186)](_0x2b100a(0x16a))[_0x2b100a(0x180)]()]),_0x3b2ebf=_0x5466b9['filter'](_0x2d6ff8=>!_0x2d6ff8['is_reversed'])[_0x2b100a(0x175)]((_0x43cfb7,_0x1e8925)=>_0x43cfb7+(_0x1e8925[_0x2b100a(0x15e)]||0x0),0x0),_0x4bbfad=_0x5466b9['filter'](_0x3555da=>_0x3555da[_0x2b100a(0x17e)])[_0x2b100a(0x175)]((_0x5660bd,_0x4583f6)=>_0x5660bd+(_0x4583f6[_0x2b100a(0x15e)]||0x0),0x0),_0x43a82a=_0x470987['reduce']((_0x3ad8ac,_0x1db370)=>_0x3ad8ac+(_0x1db370[_0x2b100a(0x17b)]||0x0),0x0);let _0x1b7d7a=[..._0x5466b9[_0x2b100a(0x17d)](_0x5d5d40=>({..._0x5d5d40,'source':_0x2b100a(0x18b)})),..._0x470987[_0x2b100a(0x17d)](_0x2a87d5=>({..._0x2a87d5,'source':_0x2b100a(0x183)}))];_0x1b7d7a['sort']((_0x3f2063,_0x4bde8d)=>new Date(_0x4bde8d[_0x2b100a(0x18a)])-new Date(_0x3f2063[_0x2b100a(0x18a)]));let _0x32d237=_0x1b7d7a['slice'](_0x42d04f,_0x42d04f+_0x378cb0);_0x32d237=await Promise['all'](_0x32d237[_0x2b100a(0x17d)](async _0x2e3e88=>{const _0x2d8ff5=_0x2b100a;if(_0x2e3e88[_0x2d8ff5(0x15f)]==='POS'){const _0x2f2a40=await inmateModel[_0x2d8ff5(0x182)]({'inmateId':_0x2e3e88[_0x2d8ff5(0x15d)]},{'custodyType':0x1,'_id':0x0})[_0x2d8ff5(0x180)]();if(_0x2f2a40)_0x2e3e88[_0x2d8ff5(0x17c)]=_0x2f2a40[_0x2d8ff5(0x17c)];}return _0x2e3e88;})),_0x490d4d['status'](0xc8)['json']({'success':!![],'range':range,'count':_0x1b7d7a[_0x2b100a(0x18e)],'page':parseInt(page),'limit':_0x378cb0,'totalPages':Math[_0x2b100a(0x174)](_0x1b7d7a[_0x2b100a(0x18e)]/_0x378cb0),'transactions':_0x32d237,'totals':{'totalPosAmount':_0x3b2ebf,'totalPosReversedAmount':_0x4bbfad,'totalFinancialAmount':_0x43a82a}});}catch(_0x58507f){console[_0x2b100a(0x18f)](_0x2b100a(0x15c),_0x58507f),_0x490d4d[_0x2b100a(0x16b)](0x1f4)['json']({'success':![],'message':_0x2b100a(0x164),'error':_0x58507f['message']});}};function a18_0x3ee3(){const _0xd1bad1=['products.productId','slice','populate','../model/financialModel','find','353437XhkslM','createdAt','POS','setDate','../model/posShoppingCart','length','error','3YtGtLl','‚ùå\x20getTransactionsByRange\x20error:','inmateId','totalAmount','source','../model/studentModel','yearly','all','exports','Internal\x20server\x20error','toLowerCase','10fryvez','312100XVpVSy','sort','daily','student_id','status','28864418Sbemyw','219852qRyhLn','2630468pwiuuk','1890844iiwXxG','8qZeYOe','getFullYear','message','getDate','ceil','reduce','setHours','25Hbmadq','json','getDay','monthly','wageAmount','custodyType','map','is_reversed','9348543pfqIxI','lean','weekly','findOne','FINANCIAL'];a18_0x3ee3=function(){return _0xd1bad1;};return a18_0x3ee3();}module[a18_0x4496fa(0x163)]={'getTransactionsByRange':getTransactionsByRange};