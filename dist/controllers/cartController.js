function a6_0x1951(_0x14e363,_0xc1bd89){_0x14e363=_0x14e363-0x121;const _0x2018c5=a6_0x2018();let _0x195176=_0x2018c5[_0x14e363];return _0x195176;}const a6_0x176e92=a6_0x1951;(function(_0x406c96,_0x291abf){const _0x38a104=a6_0x1951,_0x117803=_0x406c96();while(!![]){try{const _0x439e87=parseInt(_0x38a104(0x136))/0x1*(-parseInt(_0x38a104(0x15f))/0x2)+-parseInt(_0x38a104(0x16b))/0x3+-parseInt(_0x38a104(0x121))/0x4+parseInt(_0x38a104(0x14a))/0x5*(-parseInt(_0x38a104(0x131))/0x6)+-parseInt(_0x38a104(0x12f))/0x7*(-parseInt(_0x38a104(0x123))/0x8)+-parseInt(_0x38a104(0x122))/0x9+-parseInt(_0x38a104(0x160))/0xa*(-parseInt(_0x38a104(0x142))/0xb);if(_0x439e87===_0x291abf)break;else _0x117803['push'](_0x117803['shift']());}catch(_0x5292a5){_0x117803['push'](_0x117803['shift']());}}}(a6_0x2018,0xd794a));const POSShoppingCart=require(a6_0x176e92(0x161)),TuckShop=require(a6_0x176e92(0x137)),Inmate=require(a6_0x176e92(0x128)),mongoose=require(a6_0x176e92(0x13c)),logAudit=require(a6_0x176e92(0x171)),{checkTransactionLimit,checkProductsLimit}=require('../utils/inmateTransactionLimiter'),userModel=require(a6_0x176e92(0x16d)),InmateLocation=require(a6_0x176e92(0x164)),inmateModel=require(a6_0x176e92(0x128)),studentModel=require('../model/studentModel'),createPOSCart=async(_0x1f6aff,_0x352285)=>{const _0x1f4791=a6_0x176e92;try{const {studentId:_0x5ae207,totalAmount:_0x10cf00,products:_0x1a3ddf}=_0x1f6aff[_0x1f4791(0x13b)],_0xb74028=await userModel[_0x1f4791(0x139)](_0x1f6aff[_0x1f4791(0x125)]['id']);location_id=_0xb74028[_0x1f4791(0x146)];if(!_0xb74028[_0x1f4791(0x146)])return _0x352285[_0x1f4791(0x158)](0x194)['send']({'success':![],'message':_0x1f4791(0x165)});if(_0xb74028['location_id'][_0x1f4791(0x130)]===_0x1f4791(0x134))return _0x352285['status'](0x193)['send']({'success':![],'message':_0x1f4791(0x129)});if(!_0x5ae207||_0x10cf00===undefined||!Array[_0x1f4791(0x162)](_0x1a3ddf)||_0x1a3ddf[_0x1f4791(0x167)]===0x0)return _0x352285['status'](0x190)['json']({'message':'Missing\x20required\x20fields'});for(const _0x22d3b1 of _0x1a3ddf){if(!_0x22d3b1['productId']||!_0x22d3b1['quantity'])return _0x352285[_0x1f4791(0x158)](0x190)['json']({'message':_0x1f4791(0x149)});}const _0x42d68a=await studentModel[_0x1f4791(0x139)](_0x5ae207);if(!_0x42d68a)return _0x352285[_0x1f4791(0x158)](0x190)[_0x1f4791(0x140)]({'success':![],'message':_0x1f4791(0x13d)});if(_0x42d68a[_0x1f4791(0x124)]<_0x10cf00)return _0x352285['status'](0x190)[_0x1f4791(0x140)]({'success':![],'message':_0x1f4791(0x159)});for(const _0x45c6d7 of _0x1a3ddf){const _0x44ab74=await TuckShop['findById'](_0x45c6d7[_0x1f4791(0x12d)]);if(!_0x44ab74)return _0x352285[_0x1f4791(0x158)](0x194)[_0x1f4791(0x140)]({'message':_0x1f4791(0x14f)+_0x45c6d7[_0x1f4791(0x12d)]+'\x20not\x20found'});if(_0x44ab74[_0x1f4791(0x14c)]<_0x45c6d7[_0x1f4791(0x163)])return _0x352285[_0x1f4791(0x158)](0x190)[_0x1f4791(0x140)]({'success':![],'message':_0x1f4791(0x13a)+_0x44ab74[_0x1f4791(0x157)]+_0x1f4791(0x12a)+_0x44ab74['stockQuantity']+',\x20Requested:\x20'+_0x45c6d7[_0x1f4791(0x163)]});}for(const _0x78a65c of _0x1a3ddf){await TuckShop[_0x1f4791(0x12c)](_0x78a65c[_0x1f4791(0x12d)],{'$inc':{'stockQuantity':-_0x78a65c[_0x1f4791(0x163)]}});}const _0x47e857=new POSShoppingCart({'student_id':_0x5ae207,'totalAmount':_0x10cf00,'products':_0x1a3ddf}),_0x49141a=await _0x47e857[_0x1f4791(0x154)]();_0x42d68a[_0x1f4791(0x124)]-=_0x10cf00,await _0x42d68a[_0x1f4791(0x154)](),await logAudit({'userId':_0x1f6aff[_0x1f4791(0x125)]['id'],'username':_0x1f6aff['user'][_0x1f4791(0x147)],'inmateId':_0x5ae207,'action':_0x1f4791(0x14e),'targetModel':'POSShoppingCart','targetId':_0x49141a[_0x1f4791(0x15a)],'description':_0x1f4791(0x15d)+_0x5ae207,'changes':{'totalAmount':_0x10cf00,'products':_0x1a3ddf,'studentId':_0x5ae207}}),_0x352285[_0x1f4791(0x158)](0xc9)['json']({'success':!![],'data':_0x49141a,'message':_0x1f4791(0x145)});}catch(_0x2fb377){_0x352285[_0x1f4791(0x158)](0x1f4)['json']({'success':![],'message':'Internal\x20server\x20error','error':_0x2fb377['message']});}},getAllPOSCarts=async(_0x2e53b2,_0x53d989)=>{const _0x3850b0=a6_0x176e92;try{const _0x439a61=await POSShoppingCart[_0x3850b0(0x150)]()['populate'](_0x3850b0(0x14b))[_0x3850b0(0x16f)](_0x3850b0(0x143))[_0x3850b0(0x12e)]({'createdAt':-0x1});if(!_0x439a61||_0x439a61[_0x3850b0(0x167)]===0x0)return _0x53d989[_0x3850b0(0x158)](0x194)['json']({'success':![],'message':_0x3850b0(0x14d),'data':[]});_0x53d989[_0x3850b0(0x158)](0xc8)[_0x3850b0(0x140)]({'success':!![],'data':_0x439a61});}catch(_0x53cc48){_0x53d989[_0x3850b0(0x158)](0x1f4)[_0x3850b0(0x140)]({'success':![],'message':'Internal\x20server\x20error','error':_0x53cc48[_0x3850b0(0x132)]});}},getPOSCartById=async(_0x334f2a,_0x58ae58)=>{const _0x3fbdfb=a6_0x176e92;try{const {id:_0x14c609}=_0x334f2a[_0x3fbdfb(0x16e)];if(!mongoose[_0x3fbdfb(0x155)][_0x3fbdfb(0x141)]['isValid'](_0x14c609))return _0x58ae58['status'](0x190)['json']({'message':_0x3fbdfb(0x126)});const _0x4144e7=await POSShoppingCart[_0x3fbdfb(0x139)](_0x14c609)[_0x3fbdfb(0x16f)](_0x3fbdfb(0x143))['populate'](_0x3fbdfb(0x14b));if(!_0x4144e7)return _0x58ae58['status'](0x194)[_0x3fbdfb(0x140)]({'message':_0x3fbdfb(0x153)});_0x58ae58[_0x3fbdfb(0x158)](0xc8)[_0x3fbdfb(0x140)]({'success':!![],'data':_0x4144e7});}catch(_0x3e17a1){_0x58ae58['status'](0x1f4)[_0x3fbdfb(0x140)]({'success':![],'message':'Internal\x20server\x20error','error':_0x3e17a1[_0x3fbdfb(0x132)]});}},updatePOSCart=async(_0xfd72fe,_0x56b955)=>{const _0xc5ceb0=a6_0x176e92;try{const {id:_0x48a054}=_0xfd72fe[_0xc5ceb0(0x16e)],_0x3b1a2e=_0xfd72fe[_0xc5ceb0(0x13b)];if(!mongoose[_0xc5ceb0(0x155)][_0xc5ceb0(0x141)][_0xc5ceb0(0x13f)](_0x48a054))return _0x56b955[_0xc5ceb0(0x158)](0x190)[_0xc5ceb0(0x140)]({'message':_0xc5ceb0(0x13e)});const _0xeb2970=await POSShoppingCart[_0xc5ceb0(0x12c)](_0x48a054,_0x3b1a2e,{'new':!![],'runValidators':!![]});if(!_0xeb2970)return _0x56b955[_0xc5ceb0(0x158)](0x194)['json']({'message':_0xc5ceb0(0x172)});await logAudit({'userId':_0xfd72fe[_0xc5ceb0(0x125)]['id'],'username':_0xfd72fe[_0xc5ceb0(0x125)]['username'],'action':_0xc5ceb0(0x135),'targetModel':_0xc5ceb0(0x166),'targetId':_0xeb2970[_0xc5ceb0(0x15a)],'description':'Updated\x20POS\x20cart\x20for\x20inmate\x20'+_0xeb2970[_0xc5ceb0(0x138)],'changes':_0x3b1a2e}),_0x56b955[_0xc5ceb0(0x158)](0xc8)[_0xc5ceb0(0x140)]({'success':!![],'data':_0xeb2970,'message':'POS\x20cart\x20updated\x20successfully'});}catch(_0x700def){_0x56b955[_0xc5ceb0(0x158)](0x1f4)['json']({'success':![],'message':_0xc5ceb0(0x15c),'error':_0x700def[_0xc5ceb0(0x132)]});}},deletePOSCart=async(_0x5210ec,_0x4ee40a)=>{const _0x39c269=a6_0x176e92;try{const {id:_0xe7a961}=_0x5210ec[_0x39c269(0x16e)];if(!mongoose[_0x39c269(0x155)][_0x39c269(0x141)][_0x39c269(0x13f)](_0xe7a961))return _0x4ee40a['status'](0x190)[_0x39c269(0x140)]({'message':_0x39c269(0x13e)});const _0x549d21=await POSShoppingCart['findByIdAndDelete'](_0xe7a961);if(!_0x549d21)return _0x4ee40a['status'](0x194)['json']({'message':_0x39c269(0x172)});await logAudit({'userId':_0x5210ec[_0x39c269(0x125)]['id'],'username':_0x5210ec['user'][_0x39c269(0x147)],'action':_0x39c269(0x16c),'targetModel':_0x39c269(0x166),'targetId':_0x549d21[_0x39c269(0x15a)],'description':_0x39c269(0x148)+_0x549d21[_0x39c269(0x138)],'changes':_0x549d21}),_0x4ee40a[_0x39c269(0x158)](0xc8)[_0x39c269(0x140)]({'success':!![],'message':'POS\x20cart\x20deleted\x20successfully'});}catch(_0x445509){_0x4ee40a['status'](0x1f4)[_0x39c269(0x140)]({'success':![],'message':'Internal\x20server\x20error','error':_0x445509[_0x39c269(0x132)]});}},reversePOSCart=async(_0x131f07,_0x50cc3f)=>{const _0x4fbb23=a6_0x176e92;try{const {id:_0x5eb8f6}=_0x131f07['params'];if(_0x131f07['user'][_0x4fbb23(0x168)]!=_0x4fbb23(0x15b))return _0x50cc3f[_0x4fbb23(0x158)](0x194)['send']({'success':![],'message':_0x4fbb23(0x156)});const _0x5ab378=await POSShoppingCart[_0x4fbb23(0x139)](_0x5eb8f6);if(!_0x5ab378)return _0x50cc3f['status'](0x194)[_0x4fbb23(0x140)]({'success':![],'message':'POS\x20cart\x20not\x20found'});if(_0x5ab378[_0x4fbb23(0x169)])return _0x50cc3f[_0x4fbb23(0x158)](0x190)[_0x4fbb23(0x140)]({'success':![],'message':_0x4fbb23(0x170)});const _0x545b25=await studentModel[_0x4fbb23(0x139)](_0x5ab378[_0x4fbb23(0x143)]);if(!_0x545b25)return _0x50cc3f[_0x4fbb23(0x158)](0x194)[_0x4fbb23(0x140)]({'success':![],'message':_0x4fbb23(0x16a)});for(const _0x559408 of _0x5ab378['products']){await TuckShop[_0x4fbb23(0x12c)](_0x559408[_0x4fbb23(0x12d)],{'$inc':{'stockQuantity':_0x559408[_0x4fbb23(0x163)]}},{'new':!![]});}return _0x545b25['deposite_amount']+=_0x5ab378[_0x4fbb23(0x151)],await _0x545b25['save'](),_0x5ab378['is_reversed']=!![],await _0x5ab378[_0x4fbb23(0x154)](),await logAudit({'userId':_0x131f07['user']['id'],'username':_0x131f07['user']['username'],'action':_0x4fbb23(0x16c),'targetModel':_0x4fbb23(0x166),'targetId':_0x5ab378[_0x4fbb23(0x15a)],'description':_0x4fbb23(0x15e)+_0x5ab378[_0x4fbb23(0x143)],'changes':{..._0x5ab378[_0x4fbb23(0x152)]()}}),_0x50cc3f[_0x4fbb23(0x140)]({'success':!![],'message':_0x4fbb23(0x127),'data':{'posCartData':_0x5ab378,'updatedInmateBalance':_0x545b25['deposite_amount']}});}catch(_0x4c82fa){console[_0x4fbb23(0x144)](_0x4fbb23(0x133),_0x4c82fa),_0x50cc3f['status'](0x1f4)[_0x4fbb23(0x140)]({'success':![],'message':'Internal\x20server\x20error','error':_0x4c82fa[_0x4fbb23(0x132)]});}};function a6_0x2018(){const _0x40e502=['denied','UPDATE','562GNnTYB','../model/tuckShopModel','inmateID','findById','Insufficient\x20stock\x20for\x20item\x20\x22','body','mongoose','Inmate\x20ID\x20does\x20not\x20exist','Invalid\x20ID\x20format','isValid','json','ObjectId','55dVfjCu','student_id','error','Cart\x20created\x20successfully','location_id','username','Deleted\x20POS\x20cart\x20for\x20inmate\x20','Each\x20product\x20must\x20have\x20productId\x20and\x20quantity','7615yBLlPy','products.productId','stockQuantity','No\x20carts\x20found','CREATE','Product\x20with\x20ID\x20','find','totalAmount','toObject','Cart\x20not\x20found','save','Types','Only\x20admins\x20are\x20allowed\x20to\x20use\x20this\x20feature','itemName','status','Insufficient\x20balance','_id','ADMIN','Internal\x20server\x20error','Created\x20POS\x20cart\x20for\x20inmate\x20','Reversed\x20POS\x20cart\x20for\x20inmate\x20','4840OTsoip','9981310fasoUU','../model/posShoppingCart','isArray','quantity','../model/studentLocationModel','This\x20user\x20has\x20no\x20location','POSShoppingCart','length','role','is_reversed','studentData\x20not\x20found','1571478RuCOsi','DELETE','../model/userModel','params','populate','This\x20order\x20is\x20already\x20reversed','../utils/auditlogger','POS\x20cart\x20not\x20found','4015168uJjMMe','3527154ASHeRR','1384RSaGFq','deposite_amount','user','Invalid\x20cart\x20ID\x20format','POS\x20order\x20reversed\x20successfully','../model/studentModel','Our\x20application\x20is\x20undergoing\x20maintenance.\x20Please\x20try\x20again\x20in\x20a\x20little\x20while','\x22.\x20Available:\x20','exports','findByIdAndUpdate','productId','sort','22449uDRmzd','purchaseStatus','5448OgfTaX','message','Reverse\x20POS\x20error:'];a6_0x2018=function(){return _0x40e502;};return a6_0x2018();}module[a6_0x176e92(0x12b)]={'createPOSCart':createPOSCart,'getPOSCartById':getPOSCartById,'getAllPOSCarts':getAllPOSCarts,'updatePOSCart':updatePOSCart,'deletePOSCart':deletePOSCart,'reversePOSCart':reversePOSCart};