const a5_0x324cfe=a5_0x1337;(function(_0x1192bd,_0x385b18){const _0xf902ca=a5_0x1337,_0x2cca97=_0x1192bd();while(!![]){try{const _0x3be390=-parseInt(_0xf902ca(0x16e))/0x1+parseInt(_0xf902ca(0x1b8))/0x2+-parseInt(_0xf902ca(0x1a2))/0x3+parseInt(_0xf902ca(0x170))/0x4*(parseInt(_0xf902ca(0x1b1))/0x5)+-parseInt(_0xf902ca(0x1c0))/0x6*(-parseInt(_0xf902ca(0x152))/0x7)+parseInt(_0xf902ca(0x163))/0x8*(parseInt(_0xf902ca(0x151))/0x9)+-parseInt(_0xf902ca(0x156))/0xa*(-parseInt(_0xf902ca(0x1aa))/0xb);if(_0x3be390===_0x385b18)break;else _0x2cca97['push'](_0x2cca97['shift']());}catch(_0x52aa56){_0x2cca97['push'](_0x2cca97['shift']());}}}(a5_0x9b40,0x68097));function a5_0x9b40(){const _0x30368f=['Female','DD-MM-YYYY','sheet_to_json','Types','pop','find','../utils/auditlogger','deposite_amount','../utils/inmateTransactionLimiter','BULK_UPSERT','findByIdAndUpdate',',\x20Updated:\x20','9KYkRUG','147EBwbCp','catch','location_id','body','16760zlyiRK','moment','Invalid\x20date\x20format','No\x20file\x20uploaded',',\x20Skipped:\x20','then','mother_name','round','Bulk\x20upsert\x20of\x20wages\x20performed.\x20Created:\x20','Inmate',',\x20Failed:\x20','denied','toString','360520uEFXKa','getTime','Missing\x20department','format','_id','utils','balance','father_name','gender','lastName','Bulk\x20inmate\x20operation\x20completed','614369FQSPTP','json','478360zNSWkT','../model/studentModel','create','Duplicate\x20registration_number\x20—\x20student\x20already\x20exists','message','YYYY-MM-DD','admissionDate','status','section','Other','join','isArray','../model/studentLocationModel','findOne','student','originalname','class_name','Bulk\x20student\x20upload\x20—\x20Created:\x20','../model/financialModel','Invalid\x20location_id','push','csv','Unsupported\x20file\x20format.\x20Upload\x20CSV\x20or\x20XLSX.','ObjectId','Uploaded\x20file\x20contains\x20no\x20data','location_id\x20required','../model/userModel','crimeType','Unsupported\x20file\x20format','csv-parse/sync','location','save','Student','Missing\x20required\x20fields:\x20','custodyType','created','registration_number','Student\x20creation\x20failed:\x20','User\x20creation\x20failed:\x20','SheetNames','toLowerCase','cellNumber','Save\x20failed','../model/classModel','Bulk\x20financial\x20operation\x20completed','utf-8','user','Financial','../model/departmentModel','Sheets','2531880VHwAED','date_of_birth','skipped','firstName','toDate','number','hash','student_name','4477YQegcG','Bulk\x20student\x20upload\x20completed','split','failed','dateOfBirth','location\x20id\x20not\x20matched','findByIdAndDelete','10loKoNj','N/A','Internal\x20server\x20error','bcrypt','username','exports','Internal\x20server\x20error\x20during\x20bulk\x20upload','1146492HOXCYk','xlsx','file','read','findById','BULK_UPLOAD','buffer','isValid','98526pEBkfG','error','approved','length','INMATE'];a5_0x9b40=function(){return _0x30368f;};return a5_0x9b40();}const XLSX=require(a5_0x324cfe(0x1b9)),{parse}=require(a5_0x324cfe(0x18d)),Inmate=require(a5_0x324cfe(0x171)),Financial=require(a5_0x324cfe(0x182)),logAudit=require(a5_0x324cfe(0x1cb)),Department=require(a5_0x324cfe(0x1a0)),mongoose=require('mongoose'),{checkTransactionLimit}=require(a5_0x324cfe(0x14d)),InmateSchema=require(a5_0x324cfe(0x171)),userModel=require(a5_0x324cfe(0x18a)),bcrypt=require(a5_0x324cfe(0x1b4)),InmateLocation=require(a5_0x324cfe(0x17c)),studentLocation=require(a5_0x324cfe(0x17c)),studentModel=require(a5_0x324cfe(0x171)),classModel=require(a5_0x324cfe(0x19b)),moment=require(a5_0x324cfe(0x157)),convertExcelDate=_0x354a98=>{const _0x3bb305=a5_0x324cfe;if(typeof _0x354a98===_0x3bb305(0x1a7)){const _0x26e092=new Date(Math[_0x3bb305(0x15d)]((_0x354a98-0x63e1)*0x15180*0x3e8));return moment(_0x26e092)[_0x3bb305(0x166)](_0x3bb305(0x1c6));}const _0x185cdd=moment(_0x354a98,[_0x3bb305(0x175),_0x3bb305(0x1c6)]);if(_0x185cdd[_0x3bb305(0x1bf)]())return _0x185cdd[_0x3bb305(0x166)](_0x3bb305(0x1c6));return null;},bulkUpsertInmates=async(_0x519b49,_0x3f7599)=>{const _0x3232e4=a5_0x324cfe;try{await InmateLocation[_0x3232e4(0x14f)](_0x519b49[_0x3232e4(0x155)]['location'],{'$set':{'purchaseStatus':'denied'}})[_0x3232e4(0x15b)](async _0x2f4ff6=>{const _0x5d87f6=_0x3232e4;if(!_0x519b49[_0x5d87f6(0x1ba)])return _0x3f7599['status'](0x190)[_0x5d87f6(0x16f)]({'message':_0x5d87f6(0x159)});let _0x35317e;const _0x1eeae5=_0x519b49['file']['originalname']['split']('.')['pop']()[_0x5d87f6(0x198)]();if(_0x1eeae5===_0x5d87f6(0x185)){const _0x501b3f=_0x519b49['file']['buffer'][_0x5d87f6(0x162)]('utf-8');_0x35317e=parse(_0x501b3f,{'columns':!![],'skip_empty_lines':!![],'trim':!![]});}else{if(_0x1eeae5===_0x5d87f6(0x1b9)){const _0x37dc1f=XLSX[_0x5d87f6(0x1bb)](_0x519b49[_0x5d87f6(0x1ba)][_0x5d87f6(0x1be)],{'type':_0x5d87f6(0x1be)}),_0x3ed772=_0x37dc1f['SheetNames'][0x0];_0x35317e=XLSX[_0x5d87f6(0x168)][_0x5d87f6(0x1c7)](_0x37dc1f[_0x5d87f6(0x1a1)][_0x3ed772]);}else return _0x3f7599[_0x5d87f6(0x177)](0x190)[_0x5d87f6(0x16f)]({'message':'Unsupported\x20file\x20format'});}if(!Array[_0x5d87f6(0x17b)](_0x35317e)||_0x35317e[_0x5d87f6(0x1c3)]===0x0)return _0x3f7599['status'](0x190)['json']({'message':_0x5d87f6(0x188)});const _0x366365={'created':[],'updated':[],'failed':[]};for(const _0x175903 of _0x35317e){const {inmateId:_0x2cd5dd,firstName:_0x444588,lastName:_0x122a68,balance:_0x28eac1,status:_0x2a8be1,cellNumber:_0xf89e08,dateOfBirth:_0x235d19,admissionDate:_0x5a6332,crimeType:_0x102a07,custodyType:_0x1d2344,location_id:_0xb14846}=_0x175903;if(_0xb14846!==_0x519b49[_0x5d87f6(0x155)][_0x5d87f6(0x18e)]){_0x366365['failed'][_0x5d87f6(0x184)]({'inmateId':_0x2cd5dd,'reason':_0x5d87f6(0x1af)});continue;}if(!_0x2cd5dd||!_0x444588||!_0x122a68||_0x28eac1==null||!_0x2a8be1||!_0xf89e08||!_0x235d19||!_0x5a6332||!_0x102a07){_0x366365['failed'][_0x5d87f6(0x184)]({'inmateId':_0x2cd5dd,'reason':'Missing\x20required\x20fields'});continue;}const _0x39e142=new Date(_0x235d19),_0xa881b4=new Date(_0x5a6332);if(isNaN(_0x39e142)||isNaN(_0xa881b4)){_0x366365[_0x5d87f6(0x1ad)][_0x5d87f6(0x184)]({'inmateId':_0x2cd5dd,'reason':_0x5d87f6(0x158)});continue;}const _0x4c6b6e=await Inmate[_0x5d87f6(0x17d)]({'inmateId':_0x2cd5dd});if(_0x4c6b6e){const _0x1653d9=_0x4c6b6e[_0x5d87f6(0x1a5)]!==_0x444588||_0x4c6b6e[_0x5d87f6(0x16c)]!==_0x122a68||_0x4c6b6e['balance']!==parseFloat(_0x28eac1)||_0x4c6b6e[_0x5d87f6(0x177)]!==_0x2a8be1||_0x4c6b6e[_0x5d87f6(0x199)]!==_0xf89e08||_0x4c6b6e[_0x5d87f6(0x1ae)]['getTime']()!==_0x39e142['getTime']()||_0x4c6b6e[_0x5d87f6(0x176)][_0x5d87f6(0x164)]()!==_0xa881b4[_0x5d87f6(0x164)]()||_0x4c6b6e[_0x5d87f6(0x18b)]!==_0x102a07;_0x4c6b6e[_0x5d87f6(0x192)]!==_0x1d2344,_0x4c6b6e['location_id']!==_0xb14846,_0x1653d9&&(_0x4c6b6e[_0x5d87f6(0x1a5)]=_0x444588,_0x4c6b6e[_0x5d87f6(0x16c)]=_0x122a68,_0x4c6b6e[_0x5d87f6(0x169)]=parseFloat(_0x28eac1),_0x4c6b6e[_0x5d87f6(0x177)]=_0x2a8be1,_0x4c6b6e['cellNumber']=_0xf89e08,_0x4c6b6e['dateOfBirth']=_0x39e142,_0x4c6b6e[_0x5d87f6(0x176)]=_0xa881b4,_0x4c6b6e['crimeType']=_0x102a07,_0x4c6b6e['custodyType']=_0x1d2344,_0x4c6b6e[_0x5d87f6(0x154)]=_0xb14846,await _0x4c6b6e['save'](),_0x366365['updated'][_0x5d87f6(0x184)](_0x2cd5dd));}else{const _0x5c95ce=new Inmate({'inmateId':_0x2cd5dd,'firstName':_0x444588,'lastName':_0x122a68,'balance':parseFloat(_0x28eac1),'status':_0x2a8be1,'cellNumber':_0xf89e08,'dateOfBirth':_0x39e142,'admissionDate':_0xa881b4,'crimeType':_0x102a07,'location_id':_0xb14846,'custodyType':_0x1d2344}),_0x5679b0=await _0x5c95ce[_0x5d87f6(0x18f)]();_0x366365[_0x5d87f6(0x193)][_0x5d87f6(0x184)](_0x2cd5dd);if(_0x5679b0){const _0x21a294=await bcrypt[_0x5d87f6(0x1a8)](_0x2cd5dd,0xa),_0x451aab=new userModel({'username':_0x2cd5dd,'fullname':_0x2cd5dd,'inmateId':_0x2cd5dd,'password':_0x21a294,'role':_0x5d87f6(0x1c4),'location_id':_0xb14846});await _0x451aab[_0x5d87f6(0x18f)]()[_0x5d87f6(0x15b)](_0x77b1d9=>{})[_0x5d87f6(0x153)](_0x2aee7e=>{const _0x31d428=_0x5d87f6;_0x366365[_0x31d428(0x1ad)][_0x31d428(0x184)]({'inmateId':_0x2cd5dd,'reason':_0x2aee7e[_0x31d428(0x174)]});});}}}return await logAudit({'userId':_0x519b49[_0x5d87f6(0x19e)]['id'],'username':_0x519b49[_0x5d87f6(0x19e)][_0x5d87f6(0x1b5)],'action':'BULK_UPSERT','targetModel':_0x5d87f6(0x15f),'targetId':null,'description':'Bulk\x20upsert\x20of\x20inmates\x20performed.\x20Created:\x20'+_0x366365[_0x5d87f6(0x193)][_0x5d87f6(0x1c3)]+_0x5d87f6(0x150)+_0x366365['updated'][_0x5d87f6(0x1c3)]+_0x5d87f6(0x160)+_0x366365[_0x5d87f6(0x1ad)][_0x5d87f6(0x1c3)],'changes':_0x366365}),_0x3f7599[_0x5d87f6(0x177)](0xc8)[_0x5d87f6(0x16f)]({'success':!![],'message':_0x5d87f6(0x16d),'results':_0x366365});});}catch(_0x3b0221){return _0x3f7599[_0x3232e4(0x177)](0x1f4)[_0x3232e4(0x16f)]({'success':![],'message':_0x3232e4(0x1b3),'error':_0x3b0221[_0x3232e4(0x174)]});}finally{await InmateLocation['findByIdAndUpdate'](_0x519b49['body']['location'],{'$set':{'purchaseStatus':_0x3232e4(0x1c2)}});}},bulkUpsertStudents=async(_0x3a3566,_0x41d3fe)=>{const _0x13d1b8=a5_0x324cfe;try{if(!_0x3a3566[_0x13d1b8(0x1ba)])return _0x41d3fe['status'](0x190)[_0x13d1b8(0x16f)]({'success':![],'message':_0x13d1b8(0x159)});const {location_id:_0xa31b53}=_0x3a3566[_0x13d1b8(0x155)];if(!_0xa31b53)return _0x41d3fe['status'](0x190)[_0x13d1b8(0x16f)]({'success':![],'message':_0x13d1b8(0x189)});const _0x41e0d8=_0x3a3566[_0x13d1b8(0x1ba)][_0x13d1b8(0x17f)][_0x13d1b8(0x1ac)]('.')[_0x13d1b8(0x1c9)]()[_0x13d1b8(0x198)]();let _0x43de01=[];if(_0x41e0d8==='csv'){const _0x10360=_0x3a3566[_0x13d1b8(0x1ba)][_0x13d1b8(0x1be)][_0x13d1b8(0x162)]('utf-8');_0x43de01=parse(_0x10360,{'columns':!![],'skip_empty_lines':!![],'trim':!![]});}else{if(_0x41e0d8===_0x13d1b8(0x1b9)){const _0x436a78=XLSX[_0x13d1b8(0x1bb)](_0x3a3566[_0x13d1b8(0x1ba)][_0x13d1b8(0x1be)],{'type':_0x13d1b8(0x1be)}),_0x55baa2=_0x436a78[_0x13d1b8(0x197)][0x0];_0x43de01=XLSX['utils'][_0x13d1b8(0x1c7)](_0x436a78[_0x13d1b8(0x1a1)][_0x55baa2]);}else return _0x41d3fe[_0x13d1b8(0x177)](0x190)['json']({'success':![],'message':_0x13d1b8(0x186)});}if(!Array[_0x13d1b8(0x17b)](_0x43de01)||_0x43de01[_0x13d1b8(0x1c3)]===0x0)return _0x41d3fe['status'](0x190)[_0x13d1b8(0x16f)]({'success':![],'message':'Uploaded\x20file\x20contains\x20no\x20data'});const _0x11847f={'created':[],'skipped':[],'failed':[]};for(const _0x4c83d1 of _0x43de01){const {registration_number:_0x4614eb,student_name:_0x2b5624,father_name:_0xccd3e1,mother_name:_0x208b1c,gender:_0x5a41a4,birth_place:_0x3edbec,nationality:_0x4488dd,mother_tongue:_0x432d79,blood_group:_0x2f0c94,religion:_0x2207af,deposite_amount:_0x116a20,class_name:_0xf4e261,section:_0x29a7a3,academic_year:_0x21412f,contact_number:_0xd59a90,descriptor:_0x1e0cff,pro_pic:_0x330b92}=_0x4c83d1;let _0x383cd5=convertExcelDate(_0x4c83d1[_0x13d1b8(0x1a3)]);const _0x394235=[];if(!_0x4614eb)_0x394235[_0x13d1b8(0x184)](_0x13d1b8(0x194));if(!_0x2b5624)_0x394235[_0x13d1b8(0x184)](_0x13d1b8(0x1a9));if(!_0xccd3e1)_0x394235['push'](_0x13d1b8(0x16a));if(!_0x208b1c)_0x394235[_0x13d1b8(0x184)](_0x13d1b8(0x15c));if(!_0x383cd5)_0x394235['push'](_0x13d1b8(0x1a3));if(!_0x5a41a4)_0x394235[_0x13d1b8(0x184)](_0x13d1b8(0x16b));if(!_0xf4e261)_0x394235[_0x13d1b8(0x184)](_0x13d1b8(0x180));if(!_0x29a7a3)_0x394235[_0x13d1b8(0x184)](_0x13d1b8(0x178));if(!_0x21412f)_0x394235[_0x13d1b8(0x184)]('academic_year');if(!_0xd59a90)_0x394235[_0x13d1b8(0x184)]('contact_number');if(_0x116a20==null)_0x394235[_0x13d1b8(0x184)](_0x13d1b8(0x14c));if(_0x394235['length']>0x0){_0x11847f[_0x13d1b8(0x1ad)][_0x13d1b8(0x184)]({'registration_number':_0x4614eb||_0x13d1b8(0x1b2),'reason':_0x13d1b8(0x191)+_0x394235[_0x13d1b8(0x17a)](',\x20')});continue;}if(!['Male',_0x13d1b8(0x1c5),_0x13d1b8(0x179)]['includes'](_0x5a41a4)){_0x11847f['failed']['push']({'registration_number':_0x4614eb,'reason':'Invalid\x20gender:\x20'+_0x5a41a4});continue;}const _0x97de22=await studentLocation[_0x13d1b8(0x1bc)](_0xa31b53);if(!_0x97de22){_0x11847f[_0x13d1b8(0x1ad)]['push']({'registration_number':_0x4614eb,'reason':_0x13d1b8(0x183)});continue;}const _0x2e7b52=await studentModel[_0x13d1b8(0x17d)]({'registration_number':_0x4614eb});if(_0x2e7b52){_0x11847f[_0x13d1b8(0x1a4)][_0x13d1b8(0x184)]({'registration_number':_0x4614eb,'reason':_0x13d1b8(0x173)});continue;}let _0x21b57b=await classModel[_0x13d1b8(0x17d)]({'class_name':_0xf4e261,'section':_0x29a7a3,'academic_year':_0x21412f});if(!_0x21b57b)_0x21b57b=await classModel[_0x13d1b8(0x172)]({'class_name':_0xf4e261,'section':_0x29a7a3,'academic_year':_0x21412f});let _0x21e46f;try{const _0x505a49=await bcrypt[_0x13d1b8(0x1a8)](_0x4614eb,0xa);_0x21e46f=await userModel[_0x13d1b8(0x172)]({'username':_0x4614eb,'fullname':_0x2b5624,'password':_0x505a49,'role':_0x13d1b8(0x17e),'location_id':_0xa31b53,'descriptor':_0x1e0cff||null});}catch(_0x21cbdc){_0x11847f[_0x13d1b8(0x1ad)][_0x13d1b8(0x184)]({'registration_number':_0x4614eb,'reason':_0x13d1b8(0x196)+_0x21cbdc[_0x13d1b8(0x174)]});continue;}try{const _0x56508f=moment(_0x383cd5,[_0x13d1b8(0x175),'DD-MM-YYYY'])[_0x13d1b8(0x1a6)]();if(!_0x56508f||isNaN(_0x56508f[_0x13d1b8(0x164)]())){_0x11847f[_0x13d1b8(0x1ad)][_0x13d1b8(0x184)]({'registration_number':_0x4614eb,'reason':'Invalid\x20date_of_birth\x20format'});if(_0x21e46f)await userModel[_0x13d1b8(0x1b0)](_0x21e46f[_0x13d1b8(0x167)]);continue;}const _0xd32fa5=await studentModel['create']({'registration_number':_0x4614eb,'student_name':_0x2b5624,'father_name':_0xccd3e1,'mother_name':_0x208b1c,'date_of_birth':_0x56508f,'gender':_0x5a41a4,'birth_place':_0x3edbec,'nationality':_0x4488dd,'mother_tongue':_0x432d79,'blood_group':_0x2f0c94,'religion':_0x2207af,'deposite_amount':_0x116a20,'class_info':_0x21b57b[_0x13d1b8(0x167)],'location_id':_0xa31b53,'contact_number':_0xd59a90,'pro_pic':_0x330b92||null,'user_id':_0x21e46f['_id']});_0x11847f['created'][_0x13d1b8(0x184)]({'registration_number':_0x4614eb,'student_id':_0xd32fa5['_id']});}catch(_0x3777ef){if(_0x21e46f)await userModel[_0x13d1b8(0x1b0)](_0x21e46f[_0x13d1b8(0x167)]);_0x11847f[_0x13d1b8(0x1ad)][_0x13d1b8(0x184)]({'registration_number':_0x4614eb,'reason':_0x13d1b8(0x195)+_0x3777ef['message']});}}return _0x3a3566[_0x13d1b8(0x19e)]&&await logAudit({'userId':_0x3a3566[_0x13d1b8(0x19e)]['id'],'username':_0x3a3566[_0x13d1b8(0x19e)][_0x13d1b8(0x1b5)],'action':_0x13d1b8(0x1bd),'targetModel':_0x13d1b8(0x190),'targetId':null,'description':_0x13d1b8(0x181)+_0x11847f[_0x13d1b8(0x193)]['length']+_0x13d1b8(0x15a)+_0x11847f[_0x13d1b8(0x1a4)][_0x13d1b8(0x1c3)]+_0x13d1b8(0x160)+_0x11847f[_0x13d1b8(0x1ad)][_0x13d1b8(0x1c3)],'changes':_0x11847f}),_0x41d3fe[_0x13d1b8(0x177)](0xc8)[_0x13d1b8(0x16f)]({'success':!![],'message':_0x13d1b8(0x1ab),'summary':{'totalRecords':_0x43de01[_0x13d1b8(0x1c3)],'created':_0x11847f[_0x13d1b8(0x193)][_0x13d1b8(0x1c3)],'skipped':_0x11847f[_0x13d1b8(0x1a4)]['length'],'failed':_0x11847f[_0x13d1b8(0x1ad)][_0x13d1b8(0x1c3)]},'details':_0x11847f});}catch(_0x4a6b98){return console[_0x13d1b8(0x1c1)]('❌\x20Bulk\x20upload\x20error:',_0x4a6b98),_0x41d3fe[_0x13d1b8(0x177)](0x1f4)[_0x13d1b8(0x16f)]({'success':![],'message':_0x13d1b8(0x1b7),'error':_0x4a6b98[_0x13d1b8(0x174)]});}},bulkUpsertFinancial=async(_0x3826e9,_0x330c89)=>{const _0x6072e7=a5_0x324cfe;try{await InmateLocation[_0x6072e7(0x14f)](_0x3826e9['body'][_0x6072e7(0x18e)],{'$set':{'purchaseStatus':_0x6072e7(0x161)}})[_0x6072e7(0x15b)](async _0x3754d6=>{const _0x4c8d92=_0x6072e7;if(!_0x3826e9[_0x4c8d92(0x1ba)])return _0x330c89['status'](0x190)[_0x4c8d92(0x16f)]({'message':_0x4c8d92(0x159)});const _0xfa087d=_0x3826e9[_0x4c8d92(0x1ba)]['originalname'][_0x4c8d92(0x1ac)]('.')[_0x4c8d92(0x1c9)]()['toLowerCase']();let _0x30eac7;if(_0xfa087d===_0x4c8d92(0x185)){const _0x242fc9=_0x3826e9['file']['buffer'][_0x4c8d92(0x162)](_0x4c8d92(0x19d));_0x30eac7=parse(_0x242fc9,{'columns':!![],'skip_empty_lines':!![],'trim':!![],'delimiter':','});}else{if(_0xfa087d===_0x4c8d92(0x1b9)){const _0x4a462d=XLSX[_0x4c8d92(0x1bb)](_0x3826e9['file'][_0x4c8d92(0x1be)],{'type':_0x4c8d92(0x1be)}),_0x25efca=_0x4a462d['SheetNames'][0x0];_0x30eac7=XLSX[_0x4c8d92(0x168)]['sheet_to_json'](_0x4a462d[_0x4c8d92(0x1a1)][_0x25efca]);}else return _0x330c89[_0x4c8d92(0x177)](0x190)[_0x4c8d92(0x16f)]({'message':_0x4c8d92(0x18c)});}const _0xbdff8b={'created':[],'skipped':[],'failed':[]};for(const _0x4caa22 of _0x30eac7){let {inmateId:_0x2edd90,custodyType:_0x33c8aa,wageAmount:_0x5b26e2,hoursWorked:_0x203928,transaction:transaction='WEEKLY',workAssignId:_0x4575be,type:type='wages'}=_0x4caa22;if(!_0x2edd90||!_0x33c8aa||!type||!_0x5b26e2||!_0x203928||!transaction||!_0x4575be){_0xbdff8b['failed'][_0x4c8d92(0x184)]({'inmateId':_0x2edd90,'reason':'Missing\x20required\x20fields'});continue;}const _0x29b586=await Department[_0x4c8d92(0x1ca)]({'name':_0x4575be});if(!_0x29b586[_0x4c8d92(0x1c3)]){_0xbdff8b['failed'][_0x4c8d92(0x184)]({'inmateId':_0x2edd90,'reason':_0x4c8d92(0x165),'workAssignId':_0x4575be});continue;}const _0x5bed15=await checkTransactionLimit(_0x2edd90,parseInt(_0x5b26e2),type);if(!_0x5bed15['status']){_0xbdff8b[_0x4c8d92(0x1ad)][_0x4c8d92(0x184)]({'inmateId':_0x2edd90,'reason':_0x5bed15['message'],'workAssignId':_0x4575be});continue;}_0x4575be=new mongoose[(_0x4c8d92(0x1c8))][(_0x4c8d92(0x187))](_0x29b586[0x0][_0x4c8d92(0x167)]);try{const _0x366ef8=parseInt(_0x5b26e2||0x0);if(!_0x366ef8||isNaN(_0x366ef8)){_0xbdff8b['skipped'][_0x4c8d92(0x184)](_0x2edd90);continue;}else{const _0x54037b=new Financial({'inmateId':_0x2edd90,'transaction':transaction,'workAssignId':_0x4575be,'hoursWorked':parseInt(_0x203928||0x0),'wageAmount':_0x366ef8,'type':type,'status':'ACTIVE','custodyType':_0x33c8aa});await _0x54037b[_0x4c8d92(0x18f)]();if(_0x366ef8>0x0){const _0xf28838=await Inmate['findOne']({'inmateId':_0x2edd90});if(_0xf28838)_0xf28838['balance']+=_0x366ef8,_0xf28838['custodyType']=_0x33c8aa,await _0xf28838[_0x4c8d92(0x18f)]();else{_0xbdff8b['failed'][_0x4c8d92(0x184)]({'inmateId':_0x2edd90,'reason':'Inmate\x20not\x20found\x20for\x20balance\x20update'});continue;}}_0xbdff8b['created'][_0x4c8d92(0x184)](_0x2edd90);}}catch(_0x51c66e){_0xbdff8b[_0x4c8d92(0x1ad)][_0x4c8d92(0x184)]({'inmateId':_0x2edd90,'reason':_0x4c8d92(0x19a),'error':_0x51c66e['message'],'custodyType':_0x33c8aa});}}await logAudit({'userId':_0x3826e9['user']['id'],'username':_0x3826e9[_0x4c8d92(0x19e)][_0x4c8d92(0x1b5)],'action':_0x4c8d92(0x14e),'targetModel':_0x4c8d92(0x19f),'targetId':null,'description':_0x4c8d92(0x15e)+_0xbdff8b['created'][_0x4c8d92(0x1c3)]+',\x20Updated:\x20'+_0xbdff8b['skipped'][_0x4c8d92(0x1c3)]+',\x20Failed:\x20'+_0xbdff8b[_0x4c8d92(0x1ad)][_0x4c8d92(0x1c3)],'changes':_0xbdff8b}),_0x330c89['status'](0xc8)[_0x4c8d92(0x16f)]({'success':!![],'message':_0x4c8d92(0x19c),'results':_0xbdff8b});});}catch(_0x5df269){_0x330c89[_0x6072e7(0x177)](0x1f4)[_0x6072e7(0x16f)]({'success':![],'message':_0x6072e7(0x1b3),'error':_0x5df269[_0x6072e7(0x174)]});}finally{await InmateLocation[_0x6072e7(0x14f)](_0x3826e9[_0x6072e7(0x155)][_0x6072e7(0x18e)],{'$set':{'purchaseStatus':'approved'}});}};function a5_0x1337(_0xcd07a3,_0x299991){_0xcd07a3=_0xcd07a3-0x14c;const _0x9b4024=a5_0x9b40();let _0x1337a6=_0x9b4024[_0xcd07a3];return _0x1337a6;}module[a5_0x324cfe(0x1b6)]={'bulkUpsertInmates':bulkUpsertInmates,'bulkUpsertStudents':bulkUpsertStudents,'bulkUpsertFinancial':bulkUpsertFinancial};