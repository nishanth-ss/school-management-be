const a15_0x30a752=a15_0x18f3;function a15_0x1787(){const _0x322d94=['all','Record\x20Type','student_id','sellingPrice','Wage\x20Amount','itemNo','Content-Disposition','409922RhFWRT','inmateName','productName','TuckShop_Transaction_Report','No\x20inmates\x20found','lastName','transactionSummaryReport','POS\x20Purchase','registration_number','countDocuments','getFullYear','transactionMode','inventoryStockHistoryReport','asc','academic_year','Cell\x20Number','class_name','Department','admissionDate','No\x20students\x20found','username','desc','$stock','3monthsago','date','relationShipId','deposit','profile_picture','stockQuantity','moment','No\x20inventory\x20stock\x20history\x20found\x20in\x20selected\x20range','studentReport\x20error:','end','232gxnlTC','firstName','Generated\x20Intimate_Balance_Report','products','inventoryStockHistoryReport1','Inmate\x20ID','location_id','contact_number','toObject','populate','vendorName','Date\x20of\x20Birth','168363FPCxKb','depositType','gender','Balance','department','itemName','blood_group','workAssignId','Generated\x20Wage_Distribution_Report','setMonth','vendorPurchase','date_of_birth','wageDistributionReport','POS','7daysago','text/csv','unitPrice','Status','body','totalStock','shoppingHistory','charAt','Transaction\x20Time','locationName','limit','Basic\x20Info','items','attachment;\x20filename=inventory_stock_history.csv','format','Generated\x20TuckShop_Transaction_Report','slice','user','depositAmount','religion','cellNumber','stock','attachment;\x20filename=intimate_balance_report.csv','dateOfBirth','toUpperCase','error','productId','$balance','student_name','intimateBalanceReport','getMonth','Amount','select','inmateId','../model/tuckShopModel','transaction','Please\x20provide\x20either\x20dateRange\x20or\x20startDate\x20&\x20endDate','source','csv','recordType','Unit\x20Price','transactionDate','No\x20transaction\x20data\x20found','5yROFwA','Missing\x20required\x20fields','class_name\x20section\x20academic_year','setDate','Transaction\x20Mode','Inmate\x20not\x20found','Transaction\x20Type','attachment;\x20filename=transaction_report.csv','length','quantity','financialHistory','attachment;\x20filename=wage_distribution_report.csv','weekly','crimeType','No\x20wage\x20data\x20found\x20in\x20selected\x20range','Quantity','get','6332psLPqY','Financial','Internal\x20server\x20error','query','amount','message','category','No\x20data\x20found','Worked\x20Hours','Product\x20Name','quickStatistics','Crime\x20Type','totalQty','attachment;\x20filename=tuckshop_transaction_report.csv','file_url','pro_pic','flatMap','../model/storeInventory','Inmate(s)\x20successfully\x20fetched','yearly','vendorValue','balance','map','../model/studentModel','status','invoiceNo','getDate','exec','toLowerCase','../service/storeInventoryService','push','createdAt','name','skip','5699330FApRWu','N/A','wageAmount','4104402ldqRPD','intimateBalanceReport1','Content-Type','../model/classModel','relationship','1monthago','updatedAt','Transaction\x20Date','location','file_name\x20file_url\x20uploaded_by','Invalid\x20dateRange\x20format','totalAmount','studentReport','GENERATE','lean','Shopping','products.productId','json','Admission\x20Date','Invalid\x20dateRange\x20value','class_info','Inmate\x20Name','type','Relationship','sort','DD-MM-YYYY\x20hh:mm:ss\x20A','find','6687090SVOgkT','Intimate_Balance_Report','itemName\x20price\x20category','1233732POoxrU','price','getDay','wages','findOne','726GVkUul','DD-MM-YYYY','setHeader','parse','forEach','setHours','_id','send'];a15_0x1787=function(){return _0x322d94;};return a15_0x1787();}(function(_0x408925,_0x168a80){const _0x3741e5=a15_0x18f3,_0xd5c3fc=_0x408925();while(!![]){try{const _0x118884=parseInt(_0x3741e5(0x18e))/0x1+-parseInt(_0x3741e5(0x17a))/0x2+parseInt(_0x3741e5(0x17f))/0x3*(parseInt(_0x3741e5(0x137))/0x4)+parseInt(_0x3741e5(0x126))/0x5*(-parseInt(_0x3741e5(0x15c))/0x6)+parseInt(_0x3741e5(0x159))/0x7+-parseInt(_0x3741e5(0x1af))/0x8*(parseInt(_0x3741e5(0x1bb))/0x9)+parseInt(_0x3741e5(0x177))/0xa;if(_0x118884===_0x168a80)break;else _0xd5c3fc['push'](_0xd5c3fc['shift']());}catch(_0x161bd0){_0xd5c3fc['push'](_0xd5c3fc['shift']());}}}(a15_0x1787,0x69957));const Inmate=require(a15_0x30a752(0x14e)),Financial=require('../model/financialModel'),POSShoppingCart=require('../model/posShoppingCart'),TuckShop=require('../model/tuckShopModel'),logAudit=require('../utils/auditlogger'),{Parser}=require('json2csv'),moment=require(a15_0x30a752(0x1ab)),{getVendorPurchaseSummary}=require(a15_0x30a752(0x154)),tuckShopModel=require(a15_0x30a752(0x11d)),storeInventory=require(a15_0x30a752(0x148)),studentModel=require(a15_0x30a752(0x14e)),classModel=require(a15_0x30a752(0x15f));function a15_0x18f3(_0x442058,_0x51ccc2){_0x442058=_0x442058-0x101;const _0x1787af=a15_0x1787();let _0x18f3d7=_0x1787af[_0x442058];return _0x18f3d7;}exports[a15_0x30a752(0x141)]=async(_0x202c29,_0x30342a)=>{const _0x12a7d9=a15_0x30a752;try{const _0x458f68=new Date(),_0x2f9863=_0x458f68[_0x12a7d9(0x198)](),_0x1155b0=_0x458f68[_0x12a7d9(0x119)](),_0x6b0538=new Date(_0x2f9863,_0x1155b0,0x1);_0x6b0538[_0x12a7d9(0x184)](0x0,0x0,0x0,0x0);let _0x4fbc59=0x0,_0x40ae95=0x0;const _0x252055=await Inmate['aggregate']([{'$group':{'_id':null,'totalBalance':{'$sum':_0x12a7d9(0x116)}}}]),_0x29993a=_0x252055[0x0]?.['totalBalance']||0x0,_0x4d16bd=await Financial[_0x12a7d9(0x176)]({'createdAt':{'$gte':_0x6b0538}});_0x4d16bd[_0x12a7d9(0x183)](_0x496ed5=>{const _0x1b25ae=_0x12a7d9;if(_0x496ed5[_0x1b25ae(0x172)]==_0x1b25ae(0x17d))_0x40ae95+=_0x496ed5[_0x1b25ae(0x15b)];else _0x496ed5[_0x1b25ae(0x172)]==_0x1b25ae(0x1a8)&&(_0x4fbc59+=_0x496ed5[_0x1b25ae(0x10d)]);}),_0x30342a['status'](0xc8)['json']({'success':!![],'data':{'totalSystemBalance':_0x29993a,'monthlyWagesPaid':_0x40ae95,'monthluyDeposits':_0x4fbc59},'message':'Inmate\x20successfully\x20fetched'});}catch(_0x48a1c0){return _0x30342a[_0x12a7d9(0x14f)](0x1f4)[_0x12a7d9(0x16d)]({'message':_0x12a7d9(0x139),'error':_0x48a1c0[_0x12a7d9(0x13c)]});}},exports[a15_0x30a752(0x15d)]=async(_0x5dce61,_0x36b8b4)=>{const _0x2af498=a15_0x30a752;try{const {startDate:_0x5b8db4,endDate:_0x374208,dateRange:_0x14b68d,format:format=_0x2af498(0x16d),inmateId:_0x14a661}=_0x5dce61[_0x2af498(0x1cd)];if(!_0x14b68d&&(!_0x5b8db4||!_0x374208))return _0x36b8b4[_0x2af498(0x14f)](0x190)[_0x2af498(0x16d)]({'message':'Missing\x20required\x20fields'});let _0x359d2d,_0x397522=new Date();_0x397522[_0x2af498(0x184)](0x17,0x3b,0x3b,0x3e7);if(_0x14b68d){_0x359d2d=new Date(),_0x359d2d[_0x2af498(0x184)](0x0,0x0,0x0,0x0);switch(_0x14b68d[_0x2af498(0x153)]()){case _0x2af498(0x1c9):_0x359d2d[_0x2af498(0x129)](_0x359d2d['getDate']()-0x7);break;case _0x2af498(0x161):_0x359d2d[_0x2af498(0x1c4)](_0x359d2d['getMonth']()-0x1);break;case _0x2af498(0x1a5):_0x359d2d[_0x2af498(0x1c4)](_0x359d2d[_0x2af498(0x119)]()-0x3);break;default:return _0x36b8b4[_0x2af498(0x14f)](0x190)[_0x2af498(0x16d)]({'message':'Invalid\x20dateRange\x20format'});}}else _0x359d2d=new Date(_0x5b8db4),_0x397522=new Date(_0x374208),_0x359d2d[_0x2af498(0x184)](0x0,0x0,0x0,0x0),_0x397522['setHours'](0x17,0x3b,0x3b,0x3e7);let _0x5cdff0=[];if(_0x14a661){const _0x26e004=await Inmate[_0x2af498(0x17e)]({'inmateId':_0x14a661})[_0x2af498(0x16a)]();if(!_0x26e004)return _0x36b8b4['status'](0x194)[_0x2af498(0x16d)]({'success':![],'message':_0x2af498(0x12b)});_0x26e004['financialHistory']=await Financial[_0x2af498(0x176)]({'inmateId':_0x14a661})['lean'](),_0x26e004['shoppingHistory']=await POSShoppingCart[_0x2af498(0x176)]({'inmateId':_0x14a661})[_0x2af498(0x1b8)](_0x2af498(0x16c))[_0x2af498(0x16a)](),_0x26e004[_0x2af498(0x156)]=moment(_0x26e004[_0x2af498(0x156)])[_0x2af498(0x109)](_0x2af498(0x175)),_0x26e004['admissionDate']=moment(_0x26e004[_0x2af498(0x1a0)])['format'](_0x2af498(0x180)),_0x26e004['dateOfBirth']=moment(_0x26e004[_0x2af498(0x112)])[_0x2af498(0x109)]('DD-MM-YYYY'),_0x26e004['financialHistory'][_0x2af498(0x183)](_0xbd415=>_0xbd415[_0x2af498(0x156)]=moment(_0xbd415[_0x2af498(0x156)])['format']('DD-MM-YYYY\x20hh:mm:ss\x20A')),_0x26e004['shoppingHistory'][_0x2af498(0x183)](_0x1fde33=>_0x1fde33[_0x2af498(0x156)]=moment(_0x1fde33[_0x2af498(0x156)])[_0x2af498(0x109)](_0x2af498(0x175))),_0x5cdff0[_0x2af498(0x155)](_0x26e004);}else{_0x5cdff0=await Inmate['find']({'createdAt':{'$gte':_0x359d2d,'$lte':_0x397522}})[_0x2af498(0x16a)]();if(!_0x5cdff0[_0x2af498(0x12e)])return _0x36b8b4[_0x2af498(0x14f)](0x194)[_0x2af498(0x16d)]({'success':![],'message':_0x2af498(0x192)});}await logAudit({'userId':_0x5dce61['user']['id'],'username':_0x5dce61['user'][_0x2af498(0x1a2)],'action':'GENERATE','targetModel':_0x2af498(0x178),'targetId':null,'description':_0x2af498(0x1b1),'changes':_0x5dce61[_0x2af498(0x1cd)]});if(format===_0x2af498(0x121)){let _0x5c0d19=[];for(let _0x374cd4 of _0x5cdff0){_0x374cd4['financialHistory']&&_0x374cd4[_0x2af498(0x130)][_0x2af498(0x12e)]&&_0x374cd4['financialHistory'][_0x2af498(0x183)](_0x33f19c=>{const _0x519cc6=_0x2af498;_0x5c0d19[_0x519cc6(0x155)]({'inmateId':_0x374cd4['inmateId']||'','inmateName':(_0x374cd4[_0x519cc6(0x1b0)]||'')+'\x20'+(_0x374cd4[_0x519cc6(0x193)]||''),'cellNumber':_0x374cd4['cellNumber']||'','balance':_0x374cd4['balance']||0x0,'dateOfBirth':_0x374cd4['dateOfBirth']||'','admissionDate':_0x374cd4[_0x519cc6(0x1a0)]||'','crimeType':_0x374cd4[_0x519cc6(0x133)]||'','status':_0x374cd4[_0x519cc6(0x14f)]||'','recordType':_0x519cc6(0x138),'transaction':_0x33f19c[_0x519cc6(0x172)]['charAt'](0x0)[_0x519cc6(0x113)]()+_0x33f19c[_0x519cc6(0x172)][_0x519cc6(0x10b)](0x1)||'','transactionMode':_0x33f19c[_0x519cc6(0x1bc)]||'','relationship':_0x33f19c[_0x519cc6(0x1a7)]||'','transactionAmount':_0x33f19c[_0x519cc6(0x10d)]||0x0,'amount':_0x33f19c[_0x519cc6(0x10d)]||_0x33f19c[_0x519cc6(0x15b)]||0x0,'transactionDate':_0x33f19c[_0x519cc6(0x156)]||'','productName':'','quantity':'','unitPrice':''});}),_0x374cd4['shoppingHistory']&&_0x374cd4['shoppingHistory'][_0x2af498(0x12e)]&&_0x374cd4[_0x2af498(0x101)][_0x2af498(0x183)](_0x17249c=>{const _0x582d1c=_0x2af498;_0x17249c['products'][_0x582d1c(0x183)](_0x9c0b10=>{const _0x52fe6b=_0x582d1c;_0x5c0d19['push']({'inmateId':_0x374cd4['inmateId']||'','inmateName':(_0x374cd4['firstName']||'')+'\x20'+(_0x374cd4['lastName']||''),'cellNumber':_0x374cd4['cellNumber']||'','balance':_0x374cd4[_0x52fe6b(0x14c)]||0x0,'dateOfBirth':_0x374cd4[_0x52fe6b(0x112)]||'','admissionDate':_0x374cd4['admissionDate']||'','crimeType':_0x374cd4[_0x52fe6b(0x133)]||'','status':_0x374cd4[_0x52fe6b(0x14f)]||'','recordType':_0x52fe6b(0x16b),'transaction':'','transactionMode':'','relationship':'','amount':(_0x9c0b10[_0x52fe6b(0x115)]?.['price']||0x0)*(_0x9c0b10[_0x52fe6b(0x12f)]||0x0),'transactionDate':_0x17249c['createdAt']||'','productName':_0x9c0b10[_0x52fe6b(0x115)]?.[_0x52fe6b(0x1c0)]||'','quantity':_0x9c0b10[_0x52fe6b(0x12f)]||0x0,'unitPrice':_0x9c0b10[_0x52fe6b(0x115)]?.['price']||0x0});});}),(!_0x374cd4[_0x2af498(0x130)]||_0x374cd4[_0x2af498(0x130)][_0x2af498(0x12e)]===0x0)&&(!_0x374cd4[_0x2af498(0x101)]||_0x374cd4[_0x2af498(0x101)][_0x2af498(0x12e)]===0x0)&&_0x5c0d19[_0x2af498(0x155)]({'inmateId':_0x374cd4['inmateId']||'','inmateName':(_0x374cd4[_0x2af498(0x1b0)]||'')+'\x20'+(_0x374cd4[_0x2af498(0x193)]||''),'cellNumber':_0x374cd4['cellNumber']||'','balance':_0x374cd4['balance']||0x0,'dateOfBirth':_0x374cd4[_0x2af498(0x112)]||'','admissionDate':_0x374cd4[_0x2af498(0x1a0)]||'','crimeType':_0x374cd4[_0x2af498(0x133)]||'','status':_0x374cd4[_0x2af498(0x14f)]||'','recordType':_0x2af498(0x106),'transaction':'','transactionMode':'','relationship':'','amount':'','transactionDate':'','productName':'','quantity':'','unitPrice':''});}const _0x5798b9=[{'label':_0x2af498(0x1b4),'value':'inmateId'},{'label':_0x2af498(0x171),'value':'inmateName'},{'label':_0x2af498(0x19d),'value':_0x2af498(0x10f)},{'label':_0x2af498(0x1be),'value':_0x2af498(0x14c)},{'label':_0x2af498(0x1ba),'value':_0x2af498(0x112)},{'label':'Admission\x20Date','value':_0x2af498(0x1a0)},{'label':_0x2af498(0x142),'value':_0x2af498(0x133)},{'label':_0x2af498(0x1cc),'value':_0x2af498(0x14f)},{'label':_0x2af498(0x188),'value':'recordType'},{'label':_0x2af498(0x12c),'value':_0x2af498(0x11e)},{'label':_0x2af498(0x12a),'value':_0x2af498(0x199)},{'label':_0x2af498(0x173),'value':'relationship'},{'label':'Amount','value':_0x2af498(0x13b)},{'label':_0x2af498(0x163),'value':_0x2af498(0x124)},{'label':_0x2af498(0x140),'value':'productName'},{'label':'Quantity','value':'quantity'},{'label':_0x2af498(0x123),'value':_0x2af498(0x1cb)}],_0xc56641=new Parser({'fields':_0x5798b9}),_0x48a18f=_0xc56641[_0x2af498(0x182)](_0x5c0d19);return _0x36b8b4[_0x2af498(0x181)](_0x2af498(0x18d),_0x2af498(0x111)),_0x36b8b4[_0x2af498(0x181)]('Content-Type',_0x2af498(0x1ca)),_0x36b8b4['status'](0xc8)[_0x2af498(0x1ae)](_0x48a18f);}_0x36b8b4[_0x2af498(0x14f)](0xc8)[_0x2af498(0x16d)]({'success':!![],'data':_0x5cdff0,'message':_0x2af498(0x149)});}catch(_0x3827c4){return _0x36b8b4['status'](0x1f4)[_0x2af498(0x16d)]({'message':_0x2af498(0x139),'error':_0x3827c4['message']});}},exports[a15_0x30a752(0x118)]=async(_0x1df576,_0x5539c5)=>{const _0x5a1498=a15_0x30a752;try{const {startDate:_0x72558b,endDate:_0x188a3b,dateRange:_0x2345f9,format:format=_0x5a1498(0x16d),inmateId:_0x2d4af9}=_0x1df576[_0x5a1498(0x1cd)];if(!_0x2345f9&&(!_0x72558b||!_0x188a3b))return _0x5539c5[_0x5a1498(0x14f)](0x190)[_0x5a1498(0x16d)]({'message':_0x5a1498(0x127)});let _0x2d8781,_0x4a2903=new Date();_0x4a2903[_0x5a1498(0x184)](0x17,0x3b,0x3b,0x3e7);if(_0x2345f9){_0x2d8781=new Date(),_0x2d8781[_0x5a1498(0x184)](0x0,0x0,0x0,0x0);switch(_0x2345f9[_0x5a1498(0x153)]()){case _0x5a1498(0x1c9):_0x2d8781['setDate'](_0x2d8781[_0x5a1498(0x151)]()-0x7);break;case _0x5a1498(0x161):_0x2d8781[_0x5a1498(0x1c4)](_0x2d8781[_0x5a1498(0x119)]()-0x1);break;case _0x5a1498(0x1a5):_0x2d8781[_0x5a1498(0x1c4)](_0x2d8781[_0x5a1498(0x119)]()-0x3);break;default:return _0x5539c5['status'](0x190)[_0x5a1498(0x16d)]({'message':_0x5a1498(0x166)});}}else _0x2d8781=new Date(_0x72558b),_0x4a2903=new Date(_0x188a3b),_0x2d8781[_0x5a1498(0x184)](0x0,0x0,0x0,0x0),_0x4a2903[_0x5a1498(0x184)](0x17,0x3b,0x3b,0x3e7);let _0x241589=[];if(_0x2d4af9){const _0x1f6ab5=await Inmate[_0x5a1498(0x17e)]({'inmateId':_0x2d4af9})[_0x5a1498(0x16a)]();if(!_0x1f6ab5)return _0x5539c5[_0x5a1498(0x14f)](0x194)[_0x5a1498(0x16d)]({'success':![],'message':_0x5a1498(0x12b)});_0x1f6ab5[_0x5a1498(0x130)]=await Financial[_0x5a1498(0x176)]({'inmateId':_0x2d4af9})[_0x5a1498(0x16a)](),_0x1f6ab5[_0x5a1498(0x101)]=await POSShoppingCart[_0x5a1498(0x176)]({'inmateId':_0x2d4af9})['populate']('products.productId')[_0x5a1498(0x16a)](),_0x1f6ab5[_0x5a1498(0x156)]=moment(_0x1f6ab5[_0x5a1498(0x156)])[_0x5a1498(0x109)](_0x5a1498(0x175)),_0x1f6ab5[_0x5a1498(0x1a0)]=moment(_0x1f6ab5[_0x5a1498(0x1a0)])[_0x5a1498(0x109)](_0x5a1498(0x180)),_0x1f6ab5[_0x5a1498(0x112)]=moment(_0x1f6ab5['dateOfBirth'])[_0x5a1498(0x109)](_0x5a1498(0x180)),_0x1f6ab5['financialHistory'][_0x5a1498(0x183)](_0x4f9a97=>_0x4f9a97[_0x5a1498(0x156)]=moment(_0x4f9a97[_0x5a1498(0x156)])[_0x5a1498(0x109)](_0x5a1498(0x175))),_0x1f6ab5[_0x5a1498(0x101)][_0x5a1498(0x183)](_0x4c731a=>_0x4c731a['createdAt']=moment(_0x4c731a[_0x5a1498(0x156)])[_0x5a1498(0x109)](_0x5a1498(0x175))),_0x241589[_0x5a1498(0x155)](_0x1f6ab5);}else{_0x241589=await Inmate['find']({'createdAt':{'$gte':_0x2d8781,'$lte':_0x4a2903}})[_0x5a1498(0x16a)]();if(!_0x241589[_0x5a1498(0x12e)])return _0x5539c5[_0x5a1498(0x14f)](0x194)[_0x5a1498(0x16d)]({'success':![],'message':_0x5a1498(0x192)});for(let _0x2cd5c0 of _0x241589){_0x2cd5c0['financialHistory']=await Financial[_0x5a1498(0x176)]({'inmateId':_0x2cd5c0[_0x5a1498(0x11c)]})['lean'](),_0x2cd5c0[_0x5a1498(0x101)]=await POSShoppingCart[_0x5a1498(0x176)]({'inmateId':_0x2cd5c0['inmateId']})[_0x5a1498(0x1b8)](_0x5a1498(0x16c))[_0x5a1498(0x16a)](),_0x2cd5c0[_0x5a1498(0x156)]=moment(_0x2cd5c0['createdAt'])[_0x5a1498(0x109)](_0x5a1498(0x175)),_0x2cd5c0[_0x5a1498(0x1a0)]=moment(_0x2cd5c0[_0x5a1498(0x1a0)])[_0x5a1498(0x109)](_0x5a1498(0x180)),_0x2cd5c0['dateOfBirth']=moment(_0x2cd5c0[_0x5a1498(0x112)])[_0x5a1498(0x109)](_0x5a1498(0x180)),_0x2cd5c0['financialHistory'][_0x5a1498(0x183)](_0x1cf92e=>_0x1cf92e[_0x5a1498(0x156)]=moment(_0x1cf92e[_0x5a1498(0x156)])[_0x5a1498(0x109)](_0x5a1498(0x175))),_0x2cd5c0[_0x5a1498(0x101)][_0x5a1498(0x183)](_0x57705c=>_0x57705c[_0x5a1498(0x156)]=moment(_0x57705c[_0x5a1498(0x156)])[_0x5a1498(0x109)](_0x5a1498(0x175)));}}await logAudit({'userId':_0x1df576[_0x5a1498(0x10c)]['id'],'username':_0x1df576[_0x5a1498(0x10c)][_0x5a1498(0x1a2)],'action':_0x5a1498(0x169),'targetModel':_0x5a1498(0x178),'targetId':null,'description':_0x5a1498(0x1b1),'changes':_0x1df576[_0x5a1498(0x1cd)]});if(format===_0x5a1498(0x121)){let _0x1c61b7=[];for(let _0x366769 of _0x241589){_0x366769[_0x5a1498(0x130)]&&_0x366769[_0x5a1498(0x130)][_0x5a1498(0x12e)]&&_0x366769[_0x5a1498(0x130)][_0x5a1498(0x183)](_0x40c522=>{const _0x300ac4=_0x5a1498;_0x1c61b7['push']({'inmateId':_0x366769[_0x300ac4(0x11c)]||'','inmateName':(_0x366769['firstName']||'')+'\x20'+(_0x366769[_0x300ac4(0x193)]||''),'cellNumber':_0x366769[_0x300ac4(0x10f)]||'','balance':_0x366769[_0x300ac4(0x14c)]||0x0,'dateOfBirth':_0x366769[_0x300ac4(0x112)]||'','admissionDate':_0x366769['admissionDate']||'','crimeType':_0x366769['crimeType']||'','status':_0x366769[_0x300ac4(0x14f)]||'','recordType':_0x300ac4(0x138),'transaction':_0x40c522['type'][_0x300ac4(0x102)](0x0)['toUpperCase']()+_0x40c522[_0x300ac4(0x172)]['slice'](0x1)||'','transactionMode':_0x40c522[_0x300ac4(0x1bc)]||'','relationship':_0x40c522['relationShipId']||'','transactionAmount':_0x40c522[_0x300ac4(0x10d)]||0x0,'amount':_0x40c522[_0x300ac4(0x10d)]||_0x40c522['wageAmount']||0x0,'transactionDate':_0x40c522[_0x300ac4(0x156)]||'','productName':'','quantity':'','unitPrice':''});}),_0x366769[_0x5a1498(0x101)]&&_0x366769['shoppingHistory']['length']&&_0x366769[_0x5a1498(0x101)][_0x5a1498(0x183)](_0x272347=>{const _0x4f86ba=_0x5a1498;_0x272347[_0x4f86ba(0x1b2)][_0x4f86ba(0x183)](_0x35ccb5=>{const _0x2e86a9=_0x4f86ba;_0x1c61b7[_0x2e86a9(0x155)]({'inmateId':_0x366769[_0x2e86a9(0x11c)]||'','inmateName':(_0x366769['firstName']||'')+'\x20'+(_0x366769[_0x2e86a9(0x193)]||''),'cellNumber':_0x366769[_0x2e86a9(0x10f)]||'','balance':_0x366769[_0x2e86a9(0x14c)]||0x0,'dateOfBirth':_0x366769[_0x2e86a9(0x112)]||'','admissionDate':_0x366769[_0x2e86a9(0x1a0)]||'','crimeType':_0x366769[_0x2e86a9(0x133)]||'','status':_0x366769[_0x2e86a9(0x14f)]||'','recordType':_0x2e86a9(0x16b),'transaction':'','transactionMode':'','relationship':'','amount':(_0x35ccb5[_0x2e86a9(0x115)]?.[_0x2e86a9(0x17b)]||0x0)*(_0x35ccb5['quantity']||0x0),'transactionDate':_0x272347[_0x2e86a9(0x156)]||'','productName':_0x35ccb5['productId']?.[_0x2e86a9(0x1c0)]||'','quantity':_0x35ccb5[_0x2e86a9(0x12f)]||0x0,'unitPrice':_0x35ccb5[_0x2e86a9(0x115)]?.[_0x2e86a9(0x17b)]||0x0});});}),(!_0x366769['financialHistory']||_0x366769[_0x5a1498(0x130)][_0x5a1498(0x12e)]===0x0)&&(!_0x366769[_0x5a1498(0x101)]||_0x366769[_0x5a1498(0x101)][_0x5a1498(0x12e)]===0x0)&&_0x1c61b7[_0x5a1498(0x155)]({'inmateId':_0x366769[_0x5a1498(0x11c)]||'','inmateName':(_0x366769[_0x5a1498(0x1b0)]||'')+'\x20'+(_0x366769[_0x5a1498(0x193)]||''),'cellNumber':_0x366769['cellNumber']||'','balance':_0x366769[_0x5a1498(0x14c)]||0x0,'dateOfBirth':_0x366769['dateOfBirth']||'','admissionDate':_0x366769[_0x5a1498(0x1a0)]||'','crimeType':_0x366769[_0x5a1498(0x133)]||'','status':_0x366769[_0x5a1498(0x14f)]||'','recordType':_0x5a1498(0x106),'transaction':'','transactionMode':'','relationship':'','amount':'','transactionDate':'','productName':'','quantity':'','unitPrice':''});}const _0x3f6336=[{'label':_0x5a1498(0x1b4),'value':_0x5a1498(0x11c)},{'label':_0x5a1498(0x171),'value':_0x5a1498(0x18f)},{'label':_0x5a1498(0x19d),'value':_0x5a1498(0x10f)},{'label':_0x5a1498(0x1be),'value':_0x5a1498(0x14c)},{'label':_0x5a1498(0x1ba),'value':_0x5a1498(0x112)},{'label':_0x5a1498(0x16e),'value':_0x5a1498(0x1a0)},{'label':_0x5a1498(0x142),'value':_0x5a1498(0x133)},{'label':'Status','value':_0x5a1498(0x14f)},{'label':_0x5a1498(0x188),'value':_0x5a1498(0x122)},{'label':'Transaction\x20Type','value':_0x5a1498(0x11e)},{'label':_0x5a1498(0x12a),'value':_0x5a1498(0x199)},{'label':_0x5a1498(0x173),'value':_0x5a1498(0x160)},{'label':_0x5a1498(0x11a),'value':'amount'},{'label':_0x5a1498(0x163),'value':_0x5a1498(0x124)},{'label':_0x5a1498(0x140),'value':_0x5a1498(0x190)},{'label':_0x5a1498(0x135),'value':_0x5a1498(0x12f)},{'label':_0x5a1498(0x123),'value':_0x5a1498(0x1cb)}],_0x1b759c=new Parser({'fields':_0x3f6336}),_0x404e66=_0x1b759c[_0x5a1498(0x182)](_0x1c61b7);return _0x5539c5[_0x5a1498(0x181)]('Content-Disposition','attachment;\x20filename=intimate_balance_report.csv'),_0x5539c5[_0x5a1498(0x181)](_0x5a1498(0x15e),_0x5a1498(0x1ca)),_0x5539c5[_0x5a1498(0x14f)](0xc8)['end'](_0x404e66);}_0x5539c5[_0x5a1498(0x14f)](0xc8)[_0x5a1498(0x16d)]({'success':!![],'data':_0x241589,'message':_0x5a1498(0x149)});}catch(_0x57b438){return _0x5539c5[_0x5a1498(0x14f)](0x1f4)[_0x5a1498(0x16d)]({'message':_0x5a1498(0x139),'error':_0x57b438['message']});}},exports[a15_0x30a752(0x194)]=async(_0x591546,_0x3af65b)=>{const _0x124b32=a15_0x30a752;try{const {dateRange:dateRange='yearly',format:format=_0x124b32(0x16d),department:_0x37211a}=_0x591546[_0x124b32(0x1cd)],_0x235234=new Date();let _0x2e6f7c;switch(dateRange[_0x124b32(0x153)]()){case'daily':_0x2e6f7c=new Date(_0x235234[_0x124b32(0x184)](0x0,0x0,0x0,0x0));break;case _0x124b32(0x132):_0x2e6f7c=new Date(),_0x2e6f7c[_0x124b32(0x129)](_0x235234[_0x124b32(0x151)]()-_0x235234[_0x124b32(0x17c)]()),_0x2e6f7c[_0x124b32(0x184)](0x0,0x0,0x0,0x0);break;case'monthly':_0x2e6f7c=new Date(_0x235234[_0x124b32(0x198)](),_0x235234[_0x124b32(0x119)](),0x1);break;case _0x124b32(0x14a):_0x2e6f7c=new Date(_0x235234[_0x124b32(0x198)](),0x0,0x1);break;default:return _0x3af65b[_0x124b32(0x14f)](0x190)[_0x124b32(0x16d)]({'success':![],'message':'Invalid\x20dateRange.\x20Use\x20\x27daily\x27,\x20\x27weekly\x27,\x20\x27monthly\x27,\x20or\x20\x27yearly\x27.'});}const [_0x2ba44d,_0x267626]=await Promise[_0x124b32(0x187)]([POSShoppingCart['find']({'createdAt':{'$gte':_0x2e6f7c}})[_0x124b32(0x1b8)](_0x124b32(0x16c))[_0x124b32(0x1b8)](_0x124b32(0x189))[_0x124b32(0x16a)](),Financial[_0x124b32(0x176)]({'createdAt':{'$gte':_0x2e6f7c}})[_0x124b32(0x1b8)](_0x124b32(0x189))[_0x124b32(0x16a)]()]),_0x3f81b1=[..._0x2ba44d['map'](_0x1a47f3=>{const _0x316338=_0x124b32;return{'registration_number':_0x1a47f3[_0x316338(0x189)][_0x316338(0x196)],'transaction':_0x316338(0x195),'source':'POS','amount':_0x1a47f3[_0x316338(0x167)],'type':_0x316338(0x1c8),'createdAt':_0x1a47f3[_0x316338(0x156)]};}),..._0x267626[_0x124b32(0x14d)](_0x13fbe2=>{const _0x16ecd5=_0x124b32;return{'registration_number':_0x13fbe2[_0x16ecd5(0x189)][_0x16ecd5(0x196)],'transaction':_0x13fbe2['transaction']||'','source':'FINANCIAL','amount':_0x13fbe2[_0x16ecd5(0x10d)]||_0x13fbe2[_0x16ecd5(0x15b)]||0x0,'type':_0x13fbe2['type'],'createdAt':_0x13fbe2['createdAt']};})];_0x3f81b1['sort']((_0x51efbf,_0x37e169)=>new Date(_0x37e169['createdAt'])-new Date(_0x51efbf[_0x124b32(0x156)]));if(format==='csv'){const _0x5dcc6d=['registration_number',_0x124b32(0x11e),_0x124b32(0x120),_0x124b32(0x13b),_0x124b32(0x172),_0x124b32(0x156)],_0x2d98f8=new Parser({'fields':_0x5dcc6d}),_0x19aa99=_0x2d98f8[_0x124b32(0x182)](_0x3f81b1);return _0x3af65b[_0x124b32(0x181)](_0x124b32(0x18d),_0x124b32(0x12d)),_0x3af65b['setHeader'](_0x124b32(0x15e),_0x124b32(0x1ca)),_0x3af65b[_0x124b32(0x14f)](0xc8)[_0x124b32(0x186)](_0x19aa99);}return _0x3af65b[_0x124b32(0x14f)](0xc8)[_0x124b32(0x16d)]({'success':!![],'totalItems':_0x3f81b1[_0x124b32(0x12e)],'transactions':_0x3f81b1});}catch(_0x3a9c4a){return _0x3af65b[_0x124b32(0x14f)](0x1f4)[_0x124b32(0x16d)]({'success':![],'message':_0x124b32(0x139),'error':_0x3a9c4a['message']});}},exports['tuckShopSalesReport']=async(_0x59d514,_0x599d15)=>{const _0x549a9e=a15_0x30a752;try{let {startDate:_0x4d2b02,endDate:_0x39cdf8,dateRange:_0x252f47,format:format='json'}=_0x59d514[_0x549a9e(0x1cd)];if(!_0x252f47&&(!_0x4d2b02||!_0x39cdf8))return _0x599d15[_0x549a9e(0x14f)](0x190)['json']({'message':'Missing\x20required\x20fields'});let _0x78614b,_0x1960f2=new Date();_0x1960f2[_0x549a9e(0x184)](0x17,0x3b,0x3b,0x3e7);if(_0x252f47){_0x78614b=new Date(),_0x78614b[_0x549a9e(0x184)](0x0,0x0,0x0,0x0);switch(_0x252f47){case _0x549a9e(0x1c9):_0x78614b['setDate'](_0x78614b['getDate']()-0x6);break;case _0x549a9e(0x161):_0x78614b[_0x549a9e(0x1c4)](_0x78614b[_0x549a9e(0x119)]()-0x1);break;case'3monthsago':_0x78614b[_0x549a9e(0x1c4)](_0x78614b[_0x549a9e(0x119)]()-0x3);break;default:return _0x599d15[_0x549a9e(0x14f)](0x190)[_0x549a9e(0x16d)]({'message':'Invalid\x20dateRange\x20format'});}}else _0x78614b=new Date(_0x4d2b02),_0x1960f2=new Date(_0x39cdf8),_0x78614b[_0x549a9e(0x184)](0x0,0x0,0x0,0x0),_0x1960f2[_0x549a9e(0x184)](0x17,0x3b,0x3b,0x3e7);const _0x536db7=await POSShoppingCart[_0x549a9e(0x176)]({'createdAt':{'$gte':_0x78614b,'$lte':_0x1960f2}})[_0x549a9e(0x1b8)](_0x549a9e(0x16c),_0x549a9e(0x179))[_0x549a9e(0x16a)]();if(!_0x536db7||_0x536db7[_0x549a9e(0x12e)]===0x0)return _0x599d15['status'](0x194)['json']({'success':![],'message':_0x549a9e(0x125)});const _0x3dc721=[];_0x536db7[_0x549a9e(0x183)](_0x5a2024=>{const _0x2b7d0d=_0x549a9e;_0x5a2024[_0x2b7d0d(0x1b2)]['forEach'](_0x112f22=>{const _0x5f1ef0=_0x2b7d0d;_0x3dc721['push']({'inmateId':_0x5a2024[_0x5f1ef0(0x11c)],'productName':_0x112f22[_0x5f1ef0(0x115)]?.['itemName']||_0x5f1ef0(0x15a),'category':_0x112f22[_0x5f1ef0(0x115)]?.['category']||'N/A','quantity':_0x112f22[_0x5f1ef0(0x12f)],'price':_0x112f22['productId']?.['price']||0x0,'totalAmount':_0x5a2024[_0x5f1ef0(0x167)],'createdAt':moment(_0x5a2024[_0x5f1ef0(0x156)])['format'](_0x5f1ef0(0x175))});});}),await logAudit({'userId':_0x59d514[_0x549a9e(0x10c)]['id'],'username':_0x59d514['user'][_0x549a9e(0x1a2)],'action':_0x549a9e(0x169),'targetModel':_0x549a9e(0x191),'targetId':null,'description':_0x549a9e(0x10a),'changes':_0x59d514['body']});if(format===_0x549a9e(0x121)){const _0x30d54e=[_0x549a9e(0x11c),_0x549a9e(0x190),'category',_0x549a9e(0x12f),_0x549a9e(0x17b),'totalAmount','createdAt'],_0x519a06=new Parser({'fields':_0x30d54e}),_0x463d75=_0x519a06[_0x549a9e(0x182)](_0x3dc721);return _0x599d15[_0x549a9e(0x181)](_0x549a9e(0x18d),_0x549a9e(0x144)),_0x599d15[_0x549a9e(0x181)](_0x549a9e(0x15e),'text/csv'),_0x599d15[_0x549a9e(0x14f)](0xc8)[_0x549a9e(0x1ae)](_0x463d75);}return _0x599d15['status'](0xc8)[_0x549a9e(0x16d)]({'success':!![],'data':_0x3dc721});}catch(_0x1b4c32){return _0x599d15['status'](0x1f4)['json']({'message':_0x549a9e(0x139),'error':_0x1b4c32[_0x549a9e(0x13c)]});}},exports[a15_0x30a752(0x1c7)]=async(_0x1e6a9f,_0x51e1f5)=>{const _0x24d6d6=a15_0x30a752;try{let {startDate:_0x34026a,endDate:_0x4c8723,dateRange:_0x2c8234,format:format=_0x24d6d6(0x16d),department:_0x2cf30f}=_0x1e6a9f[_0x24d6d6(0x1cd)];if(!_0x2cf30f)return _0x51e1f5[_0x24d6d6(0x14f)](0x190)[_0x24d6d6(0x16d)]({'message':_0x24d6d6(0x127)});let _0x1917b5,_0x5a9254=new Date();_0x5a9254['setHours'](0x17,0x3b,0x3b,0x3e7);if(_0x2c8234){_0x1917b5=new Date(),_0x1917b5[_0x24d6d6(0x184)](0x0,0x0,0x0,0x0);switch(_0x2c8234){case _0x24d6d6(0x1c9):_0x1917b5[_0x24d6d6(0x129)](_0x1917b5[_0x24d6d6(0x151)]()-0x6);break;case _0x24d6d6(0x161):_0x1917b5[_0x24d6d6(0x1c4)](_0x1917b5[_0x24d6d6(0x119)]()-0x1);break;case _0x24d6d6(0x1a5):_0x1917b5['setMonth'](_0x1917b5['getMonth']()-0x3);break;default:return _0x51e1f5[_0x24d6d6(0x14f)](0x190)['json']({'message':_0x24d6d6(0x16f)});}}else{if(_0x34026a&&_0x4c8723)_0x1917b5=new Date(_0x34026a),_0x5a9254=new Date(_0x4c8723),_0x1917b5[_0x24d6d6(0x184)](0x0,0x0,0x0,0x0),_0x5a9254[_0x24d6d6(0x184)](0x17,0x3b,0x3b,0x3e7);else return _0x51e1f5[_0x24d6d6(0x14f)](0x190)[_0x24d6d6(0x16d)]({'message':_0x24d6d6(0x11f)});}const _0x234b92={'createdAt':{'$gte':_0x1917b5,'$lte':_0x5a9254},'type':'wages'};_0x2cf30f!==_0x24d6d6(0x187)&&(_0x234b92[_0x24d6d6(0x1c2)]=_0x2cf30f);const _0x5453d8=await Financial[_0x24d6d6(0x176)](_0x234b92)[_0x24d6d6(0x1b8)](_0x24d6d6(0x1c2))[_0x24d6d6(0x16a)]();_0x5453d8[_0x24d6d6(0x183)](_0x3aa1ec=>{const _0x21f659=_0x24d6d6;_0x3aa1ec[_0x21f659(0x156)]=moment(_0x3aa1ec[_0x21f659(0x156)])[_0x21f659(0x109)](_0x21f659(0x175)),_0x3aa1ec['department']=_0x3aa1ec[_0x21f659(0x1c2)]?.[_0x21f659(0x157)]||'';});if(!_0x5453d8||_0x5453d8[_0x24d6d6(0x12e)]===0x0)return _0x51e1f5[_0x24d6d6(0x14f)](0x194)[_0x24d6d6(0x16d)]({'success':![],'message':_0x24d6d6(0x134)});await logAudit({'userId':_0x1e6a9f[_0x24d6d6(0x10c)]['id'],'username':_0x1e6a9f[_0x24d6d6(0x10c)]['username'],'action':_0x24d6d6(0x169),'targetModel':'Wage_Distribution_Report','targetId':null,'description':_0x24d6d6(0x1c3),'changes':_0x1e6a9f['body']});if(format===_0x24d6d6(0x121)){const _0x4f2c7b=[{'label':_0x24d6d6(0x1b4),'value':'inmateId'},{'label':'Wage\x20Type','value':_0x24d6d6(0x11e)},{'label':_0x24d6d6(0x12c),'value':_0x24d6d6(0x172)},{'label':_0x24d6d6(0x19f),'value':_0x24d6d6(0x1bf)},{'label':_0x24d6d6(0x13f),'value':'hoursWorked'},{'label':_0x24d6d6(0x18b),'value':'wageAmount'},{'label':_0x24d6d6(0x103),'value':'createdAt'},{'label':_0x24d6d6(0x1cc),'value':'status'}],_0x41e766=new Parser({'fields':_0x4f2c7b}),_0x21d025=_0x41e766[_0x24d6d6(0x182)](_0x5453d8);return _0x51e1f5[_0x24d6d6(0x181)](_0x24d6d6(0x18d),_0x24d6d6(0x131)),_0x51e1f5[_0x24d6d6(0x181)]('Content-Type',_0x24d6d6(0x1ca)),_0x51e1f5[_0x24d6d6(0x14f)](0xc8)[_0x24d6d6(0x1ae)](_0x21d025);}_0x51e1f5['status'](0xc8)[_0x24d6d6(0x16d)]({'success':!![],'data':_0x5453d8});}catch(_0x1e05fa){return _0x51e1f5[_0x24d6d6(0x14f)](0x1f4)[_0x24d6d6(0x16d)]({'message':_0x24d6d6(0x139),'error':_0x1e05fa['message']});}},exports[a15_0x30a752(0x1b3)]=async(_0x58e8f4,_0x3b95fd)=>{const _0x166bfa=a15_0x30a752;try{let {startDate:_0x272091,endDate:_0x2cde42,dateRange:_0x2b1325,format:format='json'}=_0x58e8f4[_0x166bfa(0x1cd)];if(!_0x2b1325&&(!_0x272091||!_0x2cde42))return _0x3b95fd[_0x166bfa(0x14f)](0x190)[_0x166bfa(0x16d)]({'success':![],'message':'Please\x20provide\x20either\x20dateRange\x20or\x20startDate\x20&\x20endDate'});let _0x2fadf8,_0x4cf5fe=new Date();_0x4cf5fe[_0x166bfa(0x184)](0x17,0x3b,0x3b,0x3e7);if(_0x2b1325){_0x2fadf8=new Date(),_0x2fadf8[_0x166bfa(0x184)](0x0,0x0,0x0,0x0);switch(_0x2b1325[_0x166bfa(0x153)]()){case _0x166bfa(0x1c9):_0x2fadf8[_0x166bfa(0x129)](_0x2fadf8['getDate']()-0x6);break;case _0x166bfa(0x161):_0x2fadf8['setMonth'](_0x2fadf8[_0x166bfa(0x119)]()-0x1);break;case _0x166bfa(0x1a5):_0x2fadf8[_0x166bfa(0x1c4)](_0x2fadf8['getMonth']()-0x3);break;default:return _0x3b95fd[_0x166bfa(0x14f)](0x190)[_0x166bfa(0x16d)]({'success':![],'message':_0x166bfa(0x16f)});}}else _0x2fadf8=new Date(_0x272091),_0x4cf5fe=new Date(_0x2cde42),_0x2fadf8[_0x166bfa(0x184)](0x0,0x0,0x0,0x0),_0x4cf5fe['setHours'](0x17,0x3b,0x3b,0x3e7);const _0x4ce35f=await getVendorPurchaseSummary({..._0x58e8f4[_0x166bfa(0x13a)],'fromDate':_0x2fadf8,'toDate':_0x4cf5fe});if(!_0x4ce35f||_0x4ce35f[_0x166bfa(0x12e)]===0x0)return _0x3b95fd[_0x166bfa(0x14f)](0x194)['json']({'success':![],'message':_0x166bfa(0x1ac)});const _0x4483cd=_0x4ce35f[_0x166bfa(0x14d)](_0x3216a3=>({'itemName':_0x3216a3[_0x166bfa(0x1c0)],'category':_0x3216a3[_0x166bfa(0x13d)],'stockQuantity':_0x3216a3[_0x166bfa(0x1aa)],'price':_0x3216a3[_0x166bfa(0x17b)],'totalQty':_0x3216a3[_0x166bfa(0x143)],'status':_0x3216a3[_0x166bfa(0x14f)],'updatedAt':moment(_0x3216a3[_0x166bfa(0x162)])['format']('DD-MM-YYYY\x20hh:mm:ss\x20A')})),_0x9cbff3=_0x4ce35f[_0x166bfa(0x147)](_0x3297ab=>_0x3297ab[_0x166bfa(0x107)]['map'](_0x342aa2=>({'vendorId':_0x3297ab[_0x166bfa(0x1c5)][_0x166bfa(0x185)],'invoiceNo':_0x3297ab[_0x166bfa(0x1c5)][_0x166bfa(0x150)],'vendorName':_0x3297ab[_0x166bfa(0x1c5)][_0x166bfa(0x1b9)],'vendorValue':_0x3297ab['vendorPurchase'][_0x166bfa(0x14b)],'status':_0x3297ab[_0x166bfa(0x1c5)][_0x166bfa(0x14f)],'date':_0x3297ab[_0x166bfa(0x1c5)][_0x166bfa(0x1a6)],'itemName':_0x342aa2[_0x166bfa(0x1c0)],'quantity':_0x342aa2[_0x166bfa(0x110)],'price':_0x342aa2[_0x166bfa(0x18a)]})));if(format===_0x166bfa(0x121)){const _0xdc81d7=[_0x166bfa(0x1c0),_0x166bfa(0x13d),_0x166bfa(0x1aa),_0x166bfa(0x17b),_0x166bfa(0x143),_0x166bfa(0x14f),'updatedAt'],_0x76b6e7=new Parser({'fields':_0xdc81d7}),_0x14a540=_0x76b6e7[_0x166bfa(0x182)](_0x4483cd);return _0x3b95fd[_0x166bfa(0x181)]('Content-Disposition',_0x166bfa(0x108)),_0x3b95fd[_0x166bfa(0x181)](_0x166bfa(0x15e),_0x166bfa(0x1ca)),_0x3b95fd[_0x166bfa(0x14f)](0xc8)['end'](_0x14a540);}return _0x3b95fd[_0x166bfa(0x14f)](0xc8)[_0x166bfa(0x16d)]({'success':!![],'totalItems':_0x4483cd[_0x166bfa(0x12e)],'data':_0x4483cd});}catch(_0x4d32a6){return _0x3b95fd[_0x166bfa(0x14f)](0x1f4)[_0x166bfa(0x16d)]({'success':![],'message':_0x166bfa(0x139),'error':_0x4d32a6['message']});}},exports[a15_0x30a752(0x19a)]=async(_0x4ab043,_0x4182da)=>{const _0x11494d=a15_0x30a752;try{const {page:_0x28b2d5,limit:_0x4ff013,sortField:sortField=_0x11494d(0x156),sortOrder:sortOrder=_0x11494d(0x1a3),itemName:_0x1b8b6f,category:_0x486025,status:_0x167b1a,startDate:_0x3a03a4,endDate:_0xe94ce3,dateRange:_0x578aee,format:format='json'}=_0x4ab043[_0x11494d(0x1cd)],_0x42f55c={};if(_0x1b8b6f)_0x42f55c['itemName']={'$regex':_0x1b8b6f,'$options':'i'};if(_0x486025)_0x42f55c[_0x11494d(0x13d)]={'$regex':'^'+_0x486025+'$','$options':'i'};if(_0x167b1a)_0x42f55c[_0x11494d(0x14f)]=_0x167b1a;if(_0x3a03a4||_0xe94ce3||_0x578aee){let _0x51b726,_0x24957a=new Date();_0x24957a['setHours'](0x17,0x3b,0x3b,0x3e7);if(_0x578aee){_0x51b726=new Date(),_0x51b726[_0x11494d(0x184)](0x0,0x0,0x0,0x0);switch(_0x578aee[_0x11494d(0x153)]()){case _0x11494d(0x1c9):_0x51b726['setDate'](_0x51b726[_0x11494d(0x151)]()-0x6);break;case _0x11494d(0x161):_0x51b726[_0x11494d(0x1c4)](_0x51b726[_0x11494d(0x119)]()-0x1);break;case _0x11494d(0x1a5):_0x51b726[_0x11494d(0x1c4)](_0x51b726[_0x11494d(0x119)]()-0x3);break;default:return _0x4182da[_0x11494d(0x14f)](0x190)[_0x11494d(0x16d)]({'success':![],'message':_0x11494d(0x16f)});}}else _0x51b726=new Date(_0x3a03a4),_0x24957a=new Date(_0xe94ce3),_0x51b726[_0x11494d(0x184)](0x0,0x0,0x0,0x0),_0x24957a[_0x11494d(0x184)](0x17,0x3b,0x3b,0x3e7);_0x42f55c[_0x11494d(0x162)]={'$gte':_0x51b726,'$lte':_0x24957a};}const _0x464d1e=tuckShopModel[_0x11494d(0x176)](_0x42f55c),_0x2b67cb={};_0x2b67cb[sortField]=sortOrder[_0x11494d(0x153)]()==='asc'?0x1:-0x1,_0x464d1e[_0x11494d(0x174)](_0x2b67cb);let _0x4d0de9=![],_0x211052=0x1,_0x3aa0d6=0x0;_0x28b2d5&&_0x4ff013&&(_0x211052=parseInt(_0x28b2d5)||0x1,_0x3aa0d6=parseInt(_0x4ff013)||0xa,_0x464d1e[_0x11494d(0x158)]((_0x211052-0x1)*_0x3aa0d6)[_0x11494d(0x105)](_0x3aa0d6),_0x4d0de9=!![]);const _0x363377=await _0x464d1e[_0x11494d(0x152)]();if(!_0x363377[_0x11494d(0x12e)])return _0x4182da[_0x11494d(0x14f)](0xc8)[_0x11494d(0x16d)]({'success':!![],'message':_0x11494d(0x13e),'data':[]});const _0x6d6e57=_0x363377['map'](_0x277f9a=>_0x277f9a[_0x11494d(0x18c)]),_0x529a56=await storeInventory['aggregate']([{'$match':{'itemNo':{'$in':_0x6d6e57}}},{'$group':{'_id':'$itemNo','totalStock':{'$sum':_0x11494d(0x1a4)}}}]),_0x1f2164=new Map();_0x529a56[_0x11494d(0x183)](_0x37f353=>_0x1f2164['set'](_0x37f353[_0x11494d(0x185)],_0x37f353[_0x11494d(0x1ce)]));const _0x2459df=_0x363377['map'](_0x4b3cb2=>({..._0x4b3cb2[_0x11494d(0x1b7)](),'totalQty':_0x4b3cb2['stockQuantity']+(_0x1f2164[_0x11494d(0x136)](_0x4b3cb2[_0x11494d(0x18c)])||0x0),'updatedAt':moment(_0x4b3cb2['updatedAt'])[_0x11494d(0x109)](_0x11494d(0x175))})),_0x11fa60=await tuckShopModel['countDocuments'](_0x42f55c);if(format==='csv'){const _0x53a284=['itemName',_0x11494d(0x17b),_0x11494d(0x1aa),_0x11494d(0x143),'category','itemNo',_0x11494d(0x14f),_0x11494d(0x156),_0x11494d(0x162)],_0x18bc33=new Parser({'fields':_0x53a284}),_0x154fd9=_0x18bc33[_0x11494d(0x182)](_0x2459df);return _0x4182da[_0x11494d(0x181)](_0x11494d(0x18d),_0x11494d(0x108)),_0x4182da[_0x11494d(0x181)](_0x11494d(0x15e),'text/csv'),_0x4182da[_0x11494d(0x14f)](0xc8)[_0x11494d(0x1ae)](_0x154fd9);}if(_0x4d0de9)return _0x4182da[_0x11494d(0x14f)](0xc8)[_0x11494d(0x16d)]({'success':!![],'page':_0x211052,'limit':_0x3aa0d6,'totalCount':_0x11fa60,'data':_0x2459df});return _0x4182da[_0x11494d(0x14f)](0xc8)[_0x11494d(0x16d)]({'success':!![],'totalCount':_0x11fa60,'data':_0x2459df});}catch(_0x24fa77){return _0x4182da['status'](0x1f4)[_0x11494d(0x16d)]({'success':![],'message':'Internal\x20server\x20error','error':_0x24fa77[_0x11494d(0x13c)]});}},exports[a15_0x30a752(0x168)]=async(_0x557088,_0x56edaf)=>{const _0x35133c=a15_0x30a752;try{const {page:_0x6384f3,limit:_0x298441,sortField:sortField='createdAt',sortOrder:sortOrder=_0x35133c(0x1a3),student_name:_0x2054fc,registration_number:_0x294159,gender:_0x5e00b2,location_id:_0x688077,class_name:_0x65c1a7,format:format=_0x35133c(0x16d)}=_0x557088[_0x35133c(0x1cd)],_0x44e0df=sortOrder[_0x35133c(0x153)]()===_0x35133c(0x19b)?0x1:-0x1,_0x25fa6f={};if(_0x2054fc)_0x25fa6f[_0x35133c(0x117)]={'$regex':_0x2054fc,'$options':'i'};if(_0x294159)_0x25fa6f[_0x35133c(0x196)]={'$regex':_0x294159,'$options':'i'};if(_0x5e00b2)_0x25fa6f[_0x35133c(0x1bd)]=_0x5e00b2;if(_0x688077)_0x25fa6f[_0x35133c(0x1b5)]=_0x688077;if(_0x65c1a7){const _0x5b5311=await classModel['find']({'class_name':{'$regex':_0x65c1a7,'$options':'i'}})[_0x35133c(0x11b)](_0x35133c(0x185));if(_0x5b5311[_0x35133c(0x12e)]){const _0x51abd1=_0x5b5311[_0x35133c(0x14d)](_0x19dd34=>_0x19dd34[_0x35133c(0x185)]);_0x25fa6f['class_info']={'$in':_0x51abd1};}else return _0x56edaf['status'](0xc8)[_0x35133c(0x16d)]({'success':!![],'message':_0x35133c(0x1a1),'data':[]});}let _0x338404=studentModel[_0x35133c(0x176)](_0x25fa6f)[_0x35133c(0x1b8)](_0x35133c(0x1b5),'locationName')[_0x35133c(0x1b8)](_0x35133c(0x170),_0x35133c(0x128))[_0x35133c(0x1b8)](_0x35133c(0x146),_0x35133c(0x165))[_0x35133c(0x174)]({[sortField]:_0x44e0df}),_0x4b78ed=![],_0x2a259e=0x1,_0x40295f=0x0;_0x6384f3&&_0x298441&&(_0x2a259e=parseInt(_0x6384f3)||0x1,_0x40295f=parseInt(_0x298441)||0xa,_0x338404=_0x338404[_0x35133c(0x158)]((_0x2a259e-0x1)*_0x40295f)[_0x35133c(0x105)](_0x40295f),_0x4b78ed=!![]);const _0x13b4e1=await _0x338404['lean']();if(!_0x13b4e1[_0x35133c(0x12e)])return _0x56edaf[_0x35133c(0x14f)](0xc8)[_0x35133c(0x16d)]({'success':!![],'message':'No\x20students\x20found','data':[]});_0x13b4e1[_0x35133c(0x183)](_0x1668bd=>{const _0x578dcc=_0x35133c;_0x1668bd['createdAt']=moment(_0x1668bd['createdAt'])[_0x578dcc(0x109)](_0x578dcc(0x175)),_0x1668bd[_0x578dcc(0x162)]=moment(_0x1668bd[_0x578dcc(0x162)])[_0x578dcc(0x109)](_0x578dcc(0x175));if(_0x1668bd['date_of_birth'])_0x1668bd[_0x578dcc(0x1c6)]=moment(_0x1668bd[_0x578dcc(0x1c6)])[_0x578dcc(0x109)](_0x578dcc(0x180));});if(format===_0x35133c(0x121)){const _0x130577=_0x13b4e1[_0x35133c(0x14d)](_0x2b6169=>({'registration_number':_0x2b6169[_0x35133c(0x196)]||'','student_name':_0x2b6169[_0x35133c(0x117)]||'','gender':_0x2b6169['gender']||'','location':_0x2b6169['location_id']?.[_0x35133c(0x104)]||'','class_name':_0x2b6169[_0x35133c(0x170)]?.[_0x35133c(0x19e)]||'','section':_0x2b6169['class_info']?.['section']||'','academic_year':_0x2b6169[_0x35133c(0x170)]?.[_0x35133c(0x19c)]||'','date_of_birth':_0x2b6169['date_of_birth']||'','blood_group':_0x2b6169[_0x35133c(0x1c1)]||'','religion':_0x2b6169[_0x35133c(0x10e)]||'','mother_tongue':_0x2b6169['mother_tongue']||'','contact_number':_0x2b6169[_0x35133c(0x1b6)]||'','profile_picture':_0x2b6169[_0x35133c(0x146)]?.[_0x35133c(0x145)]||'','createdAt':_0x2b6169[_0x35133c(0x156)]||'','updatedAt':_0x2b6169[_0x35133c(0x162)]||''})),_0x5b9082=[_0x35133c(0x196),'student_name',_0x35133c(0x1bd),_0x35133c(0x164),_0x35133c(0x19e),'section','academic_year','date_of_birth',_0x35133c(0x1c1),'religion','mother_tongue',_0x35133c(0x1b6),_0x35133c(0x1a9),_0x35133c(0x156),'updatedAt'],_0x39d213=new Parser({'fields':_0x5b9082}),_0x214fe4=_0x39d213[_0x35133c(0x182)](_0x130577);return _0x56edaf[_0x35133c(0x181)](_0x35133c(0x18d),'attachment;\x20filename=student_report.csv'),_0x56edaf[_0x35133c(0x181)](_0x35133c(0x15e),_0x35133c(0x1ca)),_0x56edaf[_0x35133c(0x14f)](0xc8)['end'](_0x214fe4);}const _0x47d723=await studentModel[_0x35133c(0x197)](_0x25fa6f);if(_0x4b78ed)return _0x56edaf[_0x35133c(0x14f)](0xc8)[_0x35133c(0x16d)]({'success':!![],'page':_0x2a259e,'limit':_0x40295f,'totalCount':_0x47d723,'data':_0x13b4e1});return _0x56edaf[_0x35133c(0x14f)](0xc8)[_0x35133c(0x16d)]({'success':!![],'totalCount':_0x47d723,'data':_0x13b4e1});}catch(_0x1cc470){return console[_0x35133c(0x114)](_0x35133c(0x1ad),_0x1cc470),_0x56edaf[_0x35133c(0x14f)](0x1f4)['json']({'success':![],'message':_0x35133c(0x139),'error':_0x1cc470[_0x35133c(0x13c)]});}};